var RoadSafetyApp=function(){this.initialize=function(){this.models={};this.views={};this.templateLoader=new this.TemplateLoader};this.TemplateLoader=function(){this.templates={};this.load=function(e,t){var n=[],r=this;$.each(e,function(e,t){n.push($.get("tpl/"+t+".html",function(e){r.templates[t]=Handlebars.compile(e)}))});$.when.apply(null,n).done(t)};this.get=function(e){return this.templates[e]}};this.initialize()};rs=new RoadSafetyApp;rs.views.BasicView=Backbone.View.extend({events:{"click .pause":"showPauseScreen"},showPageMenu:function(){setTimeout(function(){app.enableTransitions();$(".page.left, .page.right").remove();$(".page-icon").removeClass("animate-1");setTimeout(function(){$(".page-text, .page-controls").removeClass("animate-1");setTimeout(function(){$(".page-play-txt").removeClass("animate-1")},100)},100)},300)},showPauseScreen:function(){$("#pause-screen, .scrollable").fadeIn();$(".bottom-menu").removeClass("animate-1")}});rs.views.SimpleView=Backbone.View.extend({initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render()},render:function(){this.$el.html(this.template());this.$el.i18n();return this}});rs.views.InfosView=Backbone.View.extend({countryHasBeenSelected:!1,topicHasBeenSelected:!1,events:{"click .inner-menu h3":"hideSingleMenu","click .show-menu":"showSingleMenu","click .inner-content":"hideAllMenus"},initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render()},render:function(){this.$el.html(this.template());this.$el.i18n();return this},hideAllMenus:function(){$(".menu").addClass("hidden");setTimeout(function(){$(".show-menu").removeClass("hidden")},400)},hideSingleMenu:function(e){var t=$(e.currentTarget);t.parents(".menu").addClass("hidden")},showSingleMenu:function(e){var t=$(e.currentTarget);e.stopPropagation();_.defer(function(){t.hasClass("show-left-menu")&&$(".left-menu").removeClass("hidden");t.hasClass("show-right-menu")&&$(".right-menu").removeClass("hidden")})}});rs.views.MemoryView=rs.views.BasicView.extend({clickedCards:0,events:function(){return _.extend({},rs.views.BasicView.prototype.events,{"click #play":"showCards","click #cards li:not(.won)":"clickCards","click .page-controls .levels li":"switchCardsNumber"})},initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render();var t=this;_.defer(function(){t.appendCardsToDOM();t.showPageMenu()})},render:function(){this.$el.html(this.template());this.$el.i18n();return this},clickCards:function(e){var t=$(e.currentTarget),n=this;t.toggleClass("flipped");t.hasClass("flipped")&&n.clickedCards++;if(n.clickedCards===2){setTimeout(function(){$(".flipped").addClass("already-turned").find(".win-overlay").fadeIn(500,function(){$(".flipped").removeClass("flipped");n.wonGame();setTimeout(function(){$(".win-overlay").hide()},200)})},800);n.clickedCards=0}},showCards:function(e){e.preventDefault();var t=this,n=0,r=70;$("#progress").removeClass("animate-1");$(".cards-icon, .text, .page-controls, #play span","#memory").addClass("animate-1");setTimeout(function(){$(".scrollable").hide()},200);setTimeout(function(){t.$("#cards").show().find("li").each(function(){n+=r;var e=$(this);setTimeout(function(){e.removeClass("animate-1");t.$("#cards").find("li.animate-1").length===0&&t.showCounter()},n)})},600)},showCounter:function(){var e=200,t=1e3-e,n=$("#info"),r,i,s="Start",o=this;r=setInterval(function(){n.removeClass("animate-1");i=setTimeout(function(){clearTimeout(i);n.addClass("animate-1");setTimeout(function(){var e=n.text();n.text(e-1);e==1&&n.text(s);if(e==s){clearInterval(r);$("#game-overlay").hide()}},e*2)},t)},t)},wonGame:function(){var e="You win!",t=$("#info"),n=this;$("#game-overlay").show();setTimeout(function(){t.css("font-size","70px").text(e).removeClass("animate-1");setTimeout(function(){t.addClass("animate-1");setTimeout(function(){$("#cards li").addClass("animate-1");setTimeout(function(){$("#progress").addClass("animate-1");$("#final-scores").show();setTimeout(function(){$("#final-scores").find(".animate-1").removeClass("animate-1");$(".bottom-menu").removeClass("animate-1");app.animateNumbers($(".your-final-score"),1539)},1e3)})},300)},2e3)},200)},appendCardsToDOM:function(e){var t=rs.templateLoader.get("memory/_card"),n={filename:"car-1.png"},r=this.$("#cards"),s=r.data("cards-number");e&&(s=e);var o=r.find("ul"),u,a,f,l=r.outerHeight()-parseInt(r.css("top")),c=this;switch(s){case 24:u=4;break;case 12:u=3;break;case 6:u=2}a=s/u;f=l/a;o.empty();for(i=0;i<s;i++)o.append($(t(n)).height(f))},switchCardsNumber:function(e){var t=$(e.currentTarget),n=t.data("level");$("#cards").attr("data-cards-number",n);this.appendCardsToDOM(n)}});var app={initialize:function(){window.PhoneGap?this.bindEvents():this.onDeviceReady()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},enableTransitions:function(){$("body").removeClass("no-transition")},animateNumbers:function(e,t,n,r,i){var s=e,o=parseInt(s.text().replace(/,/g,""));n=n===undefined?!0:n;$({value:o}).animate({value:t},{duration:r==undefined?1e3:r,easing:i==undefined?"swing":i,step:function(){s.text(Math.floor(this.value));n&&s.text(s.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "))},complete:function(){if(parseInt(s.text())!==t){s.text(t);n&&s.text(s.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "))}}})},onDeviceReady:function(){console.log("device ready");FastClick.attach(document.body);var e=this;$(document).on("click",".try-again-btn",function(){Backbone.history.stop();Backbone.history.start()});$(document).on("touchstart",".page-controls .levels li",function(){var e=$(this);$(".page-controls .levels li").removeClass("active");e.addClass("active")});var t=Backbone.Router.extend({routes:{"":"home",infos:"infos",play:"play",memory:"memory"},initialize:function(){this.bind("all",this.change)},change:function(e){$("body").addClass("no-transition")},home:function(){var e=new rs.views.SimpleView({templateName:"home"});this.slider.slidePage(e.$el)},infos:function(){var e=new rs.views.InfosView({templateName:"infos"});this.slider.slidePage(e.$el)},memory:function(){var e=new rs.views.MemoryView({templateName:"memory/memory"});this.slider.slidePage(e.$el)}}),n={resGetPath:"assets/locales/__lng__/__ns__.json",fallbackLng:"en",lng:"en"};i18n.init(n,function(e){rs.templateLoader.load(["home","infos","memory/memory","memory/_card"],function(){var e=new t;e.slider=new PageSlider($("#app"));Backbone.history.start()})})}};