var RoadSafetyApp=function(){this.initialize=function(){this.models={},this.views={},this.templateLoader=new this.TemplateLoader,this.dataLoader=new this.DataLoader},this.TemplateLoader=function(){this.templates={},this.load=function(a){var b=[],c=this;return $.each(a,function(a,d){b.push($.get("tpl/"+d+".html",function(a){c.templates[d]=Handlebars.compile(a)}))}),$.when.apply(null,b)},this.get=function(a){return this.templates[a]}},this.DataLoader=function(){this.data={},this.load=function(a){var b=[],c=this;return $.each(a,function(a,d){b.push($.get("assets/data/"+d+".json",function(a){"string"==typeof a&&(a=JSON.parse(a)),c.data[d]=a}))}),$.when.apply(null,b)},this.get=function(a){return this.data[a]}},this.initialize()};rs=new RoadSafetyApp,rs.views.BasicGameView=Backbone.View.extend({events:{"click .pause":"showPauseScreen","click .resume":"hidePauseScreen","touchstart .page-controls .levels li":"switchLevelClass","MSPointerDown .page-controls .levels li":"switchLevelClass"},initialize:function(){Handlebars.registerPartial("gamePartial",rs.templateLoader.get("_game-partial"))},showPageMenu:function(){setTimeout(function(){app.enableTransitions(),$(".page.left, .page.right").remove(),$(".page-icon").removeClass("animate-1"),setTimeout(function(){$(".page-text, .page-controls").removeClass("animate-1"),setTimeout(function(){$(".page-play-txt").removeClass("animate-1")},100)},100)},300)},showPauseScreen:function(){$("#pause-screen, .scrollable").fadeIn(),$(".bottom-menu").removeClass("animate-1")},hidePauseScreen:function(a){a.preventDefault(),$("#pause-screen, .scrollable").fadeOut(),$(".bottom-menu").addClass("animate-1")},switchLevelClass:function(a){var b=$(a.currentTarget);$(".page-controls .levels li").removeClass("active"),b.addClass("active")}}),rs.views.ChoosePlayersView=Backbone.View.extend({events:{"click .bottom li":"addPlayer"},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},addPlayer:function(a){var b=$(a.currentTarget);b.find(".playing-container").toggleClass("hidden")}}),rs.views.DisclaimerView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.GameChoiceView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.InfosView=Backbone.View.extend({events:{"click .inner-menu li":"setActiveLI","click .show-menu, .selected-info":"showSingleMenu","click .inner-content":"hideAllMenus","click .left-menu li":"selectCountry","click .right-menu li":"selectTopic"},initialize:function(){this.model=new rs.models.InfosModel,this.listenTo(this.model,"change:selectedCountry",this.updateContentPage),this.listenTo(this.model,"change:selectedTopic",this.updateContentPage),this.template=rs.templateLoader.get("infos"),this.render()},render:function(){var a={countries:rs.dataLoader.get("countries"),topics:rs.dataLoader.get("topics")};return this.$el.html(this.template(a)),this.$el.i18n(),this},hideAllMenus:function(){this.$(".menu").addClass("hidden")},hideSingleMenu:function(a){var b=$(a.currentTarget);b.parents(".menu").addClass("hidden")},showSingleMenu:function(a){var b=$(a.currentTarget);a.stopPropagation(),_.defer(function(){b.hasClass("show-left-menu")&&this.$(".left-menu").removeClass("hidden"),b.hasClass("show-right-menu")&&this.$(".right-menu").removeClass("hidden")})},setActiveLI:function(a){var b=$(a.currentTarget);b.parents(".menu").find("li").removeClass("active"),b.addClass("active")},selectCountry:function(a){var b=$(a.currentTarget);this.model.set("selectedCountry",b.attr("data-country"))},selectTopic:function(a){var b=$(a.currentTarget);this.model.set("selectedTopic",b.attr("data-topic"))},updateContentPage:function(){if(this.model.selectionDone()){this.hideAllMenus();var a=this,b="en";this.model.loadContentPage(b).done(function(b){var c=a.model.get("selectedCountry"),d=a.model.get("selectedTopic"),e=c;a.$(".selected-country").text(rs.t("country."+e));var f=_.findWhere(rs.dataLoader.get("topics"),{topic_id:d}).string_id;a.$(".selected-topic").text(rs.t("topic."+f)),$(".content-page").attr({"data-topic":d,"data-country":c}),b=b.replace(/\/internet/g,"internet"),a.$(".content-page").html(b)})}}}),rs.views.MemoryView=rs.views.BasicGameView.extend({clickedCards:0,events:function(){return _.extend({},rs.views.BasicGameView.prototype.events,{"click #play":"showCards","click #cards li:not(.won)":"clickCards","click #memory .page-controls .levels li":"switchCardsNumber"})},initialize:function(a){rs.views.BasicGameView.prototype.initialize.apply(this),this.template=rs.templateLoader.get(a.templateName),this.render();var b=this;_.defer(function(){b.appendCardsToDOM(),b.showPageMenu()})},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},clickCards:function(a){var b=$(a.currentTarget),c=this;b.toggleClass("flipped"),b.hasClass("flipped")&&c.clickedCards++,2===c.clickedCards&&(setTimeout(function(){$(".flipped").addClass("already-turned").find(".win-overlay").fadeIn(500,function(){$(".flipped").removeClass("flipped"),c.wonGame(),setTimeout(function(){$(".win-overlay").hide()},200)})},800),c.clickedCards=0)},showCards:function(a){a.preventDefault();var b=this,c=0,d=70;$("#progress").removeClass("animate-1"),$(".cards-icon, .text, .page-controls, #play span","#memory").addClass("animate-1"),setTimeout(function(){$(".scrollable").hide()},200),setTimeout(function(){b.$("#cards").show().find("li").each(function(){c+=d;var a=$(this);setTimeout(function(){a.removeClass("animate-1"),0===b.$("#cards").find("li.animate-1").length&&b.showCounter()},c)})},600)},showCounter:function(){var a,b,c=200,d=1e3-c,e=$("#info"),f="Start";a=setInterval(function(){e.removeClass("animate-1"),b=setTimeout(function(){clearTimeout(b),e.addClass("animate-1"),setTimeout(function(){var b=e.text();e.text(b-1),1==b&&e.text(f),b==f&&(clearInterval(a),$("#game-overlay").hide())},2*c)},d)},d)},wonGame:function(){var a="You win!",b=$("#info");$("#game-overlay").show(),setTimeout(function(){b.css("font-size","70px").text(a).removeClass("animate-1"),setTimeout(function(){b.addClass("animate-1"),setTimeout(function(){$("#cards li").addClass("animate-1"),setTimeout(function(){$("#progress").addClass("animate-1"),$("#final-scores").show(),setTimeout(function(){$("#final-scores").find(".animate-1").removeClass("animate-1"),$(".bottom-menu").removeClass("animate-1"),app.animateNumbers($(".your-final-score"),1539)},1e3)})},300)},2e3)},200)},appendCardsToDOM:function(a){var b=rs.templateLoader.get("memory/_card"),c={filename:"car-1.png"},d=this.$("#cards"),e=d.data("cards-number");a&&(e=a);var f,g,h,j=d.find("ul"),k=d.outerHeight()-parseInt(d.css("top"));switch(e){case 24:f=4;break;case 12:f=3;break;case 6:f=2}for(g=e/f,h=k/g,j.empty(),i=0;e>i;i++)j.append($(b(c)).height(h))},switchCardsNumber:function(a){var b=$(a.currentTarget),c=b.data("level");$("#cards").attr("data-cards-number",c),this.appendCardsToDOM(c)}}),rs.views.ModeView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.QuestionView=rs.views.BasicGameView.extend({events:function(){return _.extend({},rs.views.BasicGameView.prototype.events,{})},initialize:function(a){rs.views.BasicGameView.prototype.initialize.apply(this),this.template=rs.templateLoader.get(a.templateName),this.render(),this.checkImage()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},checkImage:function(){var a=this.$("#question-zone");0===a.find("img").length&&a.addClass("no-image")}}),rs.views.QuizzView=rs.views.BasicGameView.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render();var b=this;_.defer(function(){b.showPageMenu()})},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.ResultMultiView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.ResultSoloView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.SettingsView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.SimpleView=Backbone.View.extend({initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.SwitchPlayerView=Backbone.View.extend({events:{},initialize:function(a){Handlebars.registerPartial("gamePartial",rs.templateLoader.get("_game-partial")),this.template=rs.templateLoader.get(a.templateName),this.render(),this.$(".bottom-menu").removeClass("animate-1")},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.models.InfosModel=Backbone.Model.extend({defaults:{selectedCountry:null,selectedTopic:null},selectionDone:function(){return null!==this.get("selectedCountry")&&null!==this.get("selectedTopic")},loadContentPage:function(a){var b=this.get("selectedCountry"),c=this.get("selectedTopic"),d=this.getContentPagePath(b,c,a);return $.get(d)},getContentPagePath:function(a,b,c){return"assets/rules/"+c+"/"+a+"/"+a+"_"+b+"_"+c+".html"}});var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},enableTransitions:function(){$("body").removeClass("no-transition")},animateNumbers:function(a,b,c,d,e){var f=a,g=parseInt(f.text().replace(/,/g,""));c=void 0===c?!0:c,$({value:g}).animate({value:b},{duration:void 0==d?1e3:d,easing:void 0==e?"swing":e,step:function(){f.text(Math.floor(this.value)),c&&f.text(f.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "))},complete:function(){parseInt(f.text())!==b&&(f.text(b),c&&f.text(f.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 ")))}})},onDeviceReady:function(){console.log("device ready"),function(){var a=document.createElement("script");a.src="http://192.168.1.5:8080/target/target-script-min.js#anonymous",document.body.appendChild(a)}(),FastClick.attach(document.body);$(document).on("click",".try-again-btn, .back-to-home",function(){Backbone.history.stop(),Backbone.history.start()});var a=Backbone.Router.extend({routes:{"":"home",settings:"settings",infos:"infos",disclaimer:"disclaimer","game-choice":"gameChoice",memory:"memory",mode:"mode","choose-players":"choosePlayers","result-solo":"resultSolo","result-multi":"resultMulti",question:"question","switch-player":"switchPlayer"},initialize:function(){this.bind("all",this.change)},change:function(){$("body").addClass("no-transition")},home:function(){var a=new rs.views.SimpleView({templateName:"home"});this.slider.slidePage(a.$el)},settings:function(){var a=new rs.views.SettingsView({templateName:"settings"});this.slider.slidePage(a.$el)},infos:function(){var a=new rs.views.InfosView({templateName:"infos"});this.slider.slidePage(a.$el)},disclaimer:function(){var a=new rs.views.InfosView({templateName:"disclaimer"});this.slider.slidePage(a.$el)},gameChoice:function(){var a=new rs.views.GameChoiceView({templateName:"game-choice"});this.slider.slidePage(a.$el)},memory:function(){var a=new rs.views.MemoryView({templateName:"memory/memory"});this.slider.slidePage(a.$el)},quizz:function(){var a=new rs.views.QuizzView({templateName:"quizz/quizz"});this.slider.slidePage(a.$el)},mode:function(){var a=new rs.views.ModeView({templateName:"quizz/mode"});this.slider.slidePage(a.$el)},choosePlayers:function(){var a=new rs.views.ChoosePlayersView({templateName:"quizz/choose-players"});this.slider.slidePage(a.$el)},resultSolo:function(){var a=new rs.views.ResultMultiView({templateName:"quizz/result-solo"});this.slider.slidePage(a.$el)},resultMulti:function(){var a=new rs.views.ResultMultiView({templateName:"quizz/result-multi"});this.slider.slidePage(a.$el)},question:function(){var a=new rs.views.QuestionView({templateName:"quizz/question"});this.slider.slidePage(a.$el)},switchPlayer:function(){var a=new rs.views.SwitchPlayerView({templateName:"quizz/switch-player"});this.slider.slidePage(a.$el)}}),b={resGetPath:"assets/locales/__lng__/__ns__.json",fallbackLng:"en",lng:"en"};i18n.init(b,function(b){rs.t=b;var c=["home","infos","settings","disclaimer","game-choice","memory/memory","memory/_card","quizz/quizz","quizz/mode","quizz/choose-players","quizz/result-solo","quizz/result-multi","quizz/question","quizz/switch-player","_game-partial"],d=["countries","topics","languages"];$.when(rs.templateLoader.load(c),rs.dataLoader.load(d)).done(function(){var b=new a;b.slider=new PageSlider($("#app")),Backbone.history.start()})})}};