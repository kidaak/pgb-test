function PageSlider(a){var b,a=a,c=[];this.slidePage=function(a){var d=c.length,e=window.location.hash;return a===b?void console.log("page === currentPage"):0===d?(c.push(e),this.slidePageFrom(a)):e===c[d-2]?(c.pop(),this.slidePageFrom(a,"left")):(c.push(e),this.slidePageFrom(a,"right"))},this.slidePageFrom=function(c,d){var e=$.Deferred();if(a.append(c),!b||!d)return c.attr("class","page center"),b=c,e.resolve(),e;c.attr("class","page "+d),this.disableInteraction();var f=this,g=b;return g.one("transitionend webkitTransitionEnd msTransitionEnd",function(){setTimeout(function(){g.remove(),e.resolve(),f.enableInteraction()},100)}),a[0].offsetWidth,c.attr("class","page transition center"),b.attr("class","page transition "+("left"===d?"right":"left")),b=c,e},this.disableInteraction=function(){$("#disable-interaction").show()},this.enableInteraction=function(){$("#disable-interaction").hide()}}function ViewSlider(a){var b,c=new PageSlider(a);this.slideView=function(a){return this.slideViewFrom(a,!1)},this.slideViewFrom=function(a,d){var e,f=$.Deferred(),g=a.$el,h=b;return e=d?c.slidePageFrom(g,d):c.slidePage(g),b=a,e.done(function(){h&&(h.remove(),h.onRemove&&h.onRemove()),f.resolve()}),f.promise()},this.disableInteraction=function(){c.disableInteraction()},this.enableInteraction=function(){c.enableInteraction()}}var RoadSafetyApp=function(){this.initialize=function(){this.models={},this.collections={},this.views={},this.utils={},this.templateLoader=new this.TemplateLoader,this.dataLoader=new this.DataLoader},this.TemplateLoader=function(){this.templates={},this.load=function(a){var b=[],c=this;return $.each(a,function(a,d){b.push($.get("tpl/"+d+".html",function(a){c.templates[d]=Handlebars.compile(a)}))}),$.when.apply(null,b)},this.get=function(a){return this.templates[a]}},this.DataLoader=function(){this.data={},this.load=function(a){var b=[],c=this;return $.each(a,function(a,d){b.push($.get("assets/data/"+d+".json",function(a){"string"==typeof a&&(a=JSON.parse(a)),c.data[d]=a}))}),$.when.apply(null,b)},this.get=function(a){return this.data[a]}},this.initialize()};rs=new RoadSafetyApp,rs.utils.MediaPlayer=function(){this.filenames={loading:"End_Loading_apply.mp3",settings:"Bouton_Settings.mp3",misc:"Bouton_Divers.mp3",select:"Bouton_Pays_categorie.mp3",easy:"Bouton_Easy.mp3",medium:"Bouton_Medium.mp3",hard:"Bouton_Hard.mp3",play:"Bouton_Play.mp3",countdown:"Countdown_Start.mp3",flip:"Carte_retournement.mp3",match:"Carte_bonne_correspondance.mp3",nomatch:"Carte_mauvaise_correspondance.mp3",memory_win:"Memory_winner.mp3",memory_lose:"Memory_looser.mp3",solo:"Player_Single.mp3",multi:"Player_Multi.mp3",good_answer:"Quizz_good_answer.mp3",bad_answer:"Quizz_bad_answer.mp3",quiz_win:"Quizz_winner.mp3",quiz_lose:"Quizz_looser.mp3",timer_15:"Timing_car_15sec.mp3",timer_30:"Timing_car_30sec.mp3",timer_60:"Timing_car_60sec.mp3",score:"Number_score.mp3"},this.medias={},this.mediaPluginEnabled=function(){return void 0!==window.Media},this.preload=function(a){if(this.mediaPluginEnabled()){var b="assets/sounds/";window.device&&"Android"==device.platform&&(b="/android_asset/www/"+b);for(var c=0;c<a.length;c++){var d=a[c],e=this.filenames[d],f=b+e;this.medias[d]=new Media(f,function(){},function(a){console.log("playAudio():Audio Error: "),console.log(a)})}}},this.play=function(a,b){if(b=b||0,console.log("Play sound: "+a+" with delay: "+b),!this.mediaPluginEnabled())return{play:function(){},stop:function(){},pause:function(){}};var c=this.medias[a];return setTimeout(function(){c.setVolume(rs.settings.soundVolume()),c.play({playAudioWhenScreenIsLocked:!1})},b),c},this.release=function(){if(this.mediaPluginEnabled()){for(var a in this.medias)this.medias[a].release();medias={}}}},rs.AppRouter=Backbone.Router.extend({routes:{loading:"loading","":"home",settings:"settings",info:"info",disclaimer:"disclaimer","game-choice":"gameChoice",memory:"memory",quiz:"quiz"},initialize:function(){this.bind("all",this.change)},change:function(){$("body").addClass("no-transition")},loading:function(){var a=new rs.views.LoadingView;this.slider.slideView(a)},home:function(){var a=new rs.views.HomeView;this.slider.slideView(a)},settings:function(){var a=new rs.views.SettingsView({templateName:"settings"});this.slider.slideView(a)},info:function(){var a=new rs.views.InfoView;this.slider.slideView(a)},disclaimer:function(){var a=new rs.views.InfosView({templateName:"disclaimer"});this.slider.slideView(a)},gameChoice:function(){var a=new rs.views.GameChoiceView({templateName:"game-choice"});this.slider.slideView(a)},memory:function(){var a=new rs.views.MemoryView;this.slider.slideView(a)},quiz:function(){var a=new rs.views.QuizView;this.slider.slideView(a)}}),rs.views.BasicGameView=Backbone.View.extend({events:{"click .pause":"showPauseScreen","click #pause-screen":"hidePauseScreen","touchstart .page-controls .levels li":"switchLevelClass","MSPointerDown .page-controls .levels li":"switchLevelClass"},initialize:function(){Handlebars.registerPartial("gamePartial",rs.templateLoader.get("_game-partial"))},showPageMenu:function(){setTimeout(function(){app.enableTransitions(),$(".page-icon").removeClass("animate-1"),setTimeout(function(){$(".page-text, .page-controls").removeClass("animate-1"),setTimeout(function(){$(".page-play-txt").removeClass("animate-1")},100)},100)},300)},showPauseScreen:function(){$("#pause-screen, .scrollable").fadeIn(),$(".bottom-menu").removeClass("animate-1")},hidePauseScreen:function(a){a.preventDefault(),$("#pause-screen, .scrollable").fadeOut(),$(".bottom-menu").addClass("animate-1")},switchLevelClass:function(a){var b=$(a.currentTarget);$(".page-controls .levels li").removeClass("active"),b.addClass("active")}}),rs.views.ChoosePlayersView=Backbone.View.extend({initialize:function(){if(this.collection=new rs.collections.PlayerCollection,this.collection.fetch(),0===this.collection.length){console.log("create players");for(var a=0;6>a;a++)this.collection.add({id:a+1});this.collection.saveAll()}this.template=rs.templateLoader.get("quiz/choose-players"),this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["play","select","misc"]),this.render()},onRemove:function(){this.mediaPlayer.release()},render:function(){this.$el.html(this.template()),this.$el.i18n(),this.$('input[name="name"]').attr("maxlength","12");var a=this;return this.collection.each(function(b){a.$(".players-list li[data-player-id="+b.id+'] input[name="name"]').val(b.name())}),this.$('.players-list li[data-player-id="1"] .playing-container').toggleClass("hidden"),this.$('.players-list li[data-player-id="2"] .playing-container').toggleClass("hidden"),this},events:{"click .bottom li":"addPlayer","click input":"stopInputPropagation","click #play":"play","input .bottom li":"changeName","click a.back-to-home":"backToHome"},addPlayer:function(a){this.mediaPlayer.play("select",0);var b=$(a.currentTarget);b.find(".playing-container").toggleClass("hidden")},stopInputPropagation:function(a){a.stopPropagation()},play:function(a){a.preventDefault();var b=this.selectedPlayers();b.length>=2?(this.mediaPlayer.play("play",0),this.trigger("playMulti",this.selectedPlayers())):this.mediaPlayer.play("misc",0)},changeName:function(a){var b=$(a.currentTarget),c=b.attr("data-player-id"),d=b.find('input[name="name"]').val(),e=this.collection.get(c);e.set("name",d),e.save()},selectedPlayers:function(){var a=[],b=this;return this.$(".bottom li").each(function(){if($(this).find(".playing-container").is(":visible")){var c=$(this).attr("data-player-id"),d=b.collection.get(c);a.push(d)}}),a},backToHome:function(){this.mediaPlayer.play("select",0)}}),rs.views.DisclaimerView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.GameChoiceView=Backbone.View.extend({initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["select"]),this.render()},onRemove:function(){this.mediaPlayer.release()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:{"click .quiz-btn a":"quiz","click .memory-btn a":"memory","click a.back-to-home":"backToHome"},quiz:function(){this.mediaPlayer.play("select",0)},memory:function(){this.mediaPlayer.play("select",0)},backToHome:function(){this.mediaPlayer.play("select",0)}}),rs.views.HomeView=Backbone.View.extend({initialize:function(){this.template=rs.templateLoader.get("home"),this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["settings","select"]),this.render()},onRemove:function(){this.mediaPlayer.release()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:{"click .settings-bar a":"settings","click #highway-codes a":"info","click #travel-games a":"games"},settings:function(){this.mediaPlayer.play("settings",0)},info:function(){this.mediaPlayer.play("select",0)},games:function(){this.mediaPlayer.play("select",0)}}),rs.views.InfoView=Backbone.View.extend({initialize:function(){this.model=new rs.models.InfoModel({id:1}),this.model.fetch(),this.listenTo(this.model,"change:selectedCountry",this.updateContentPage),this.listenTo(this.model,"change:selectedTopic",this.updateContentPage),this.template=rs.templateLoader.get("info"),this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["select"]),this.render(),this.model.selectionDone()&&(this.updateContentPage(),this.$('.left-menu li[data-country="'+this.model.get("selectedCountry")+'"]').addClass("active"),this.$('.right-menu li[data-topic="'+this.model.get("selectedTopic")+'"]').addClass("active"),this.hideAllMenus())},onRemove:function(){this.mediaPlayer.release()},render:function(){var a={countries:rs.dataLoader.get("countries"),topics:rs.dataLoader.get("topics")};return this.$el.html(this.template(a)),this.$el.i18n(),this},events:{"click .inner-menu h3":"hideSingleMenu","click .inner-menu li":"setActiveLI","click .show-menu, .selected-info":"showSingleMenu","click .inner-content":"hideAllMenus","click .left-menu li":"selectCountry","click .right-menu li":"selectTopic","click a.back-to-home":"backToHome"},hideAllMenus:function(){this.$(".menu").addClass("hidden")},hideSingleMenu:function(a){if(this.model.selectionDone()){var b=$(a.currentTarget);b.parents(".menu").addClass("hidden")}},showSingleMenu:function(a){var b=$(a.currentTarget);a.stopPropagation(),_.defer(function(){b.hasClass("show-left-menu")&&this.$(".left-menu").removeClass("hidden"),b.hasClass("show-right-menu")&&this.$(".right-menu").removeClass("hidden")})},setActiveLI:function(a){var b=$(a.currentTarget);b.parents(".menu").find("li").removeClass("active"),b.addClass("active")},selectCountry:function(a){this.mediaPlayer.play("select",0);var b=$(a.currentTarget);this.model.set("selectedCountry",b.attr("data-country")),this.model.selectionDone()&&this.hideAllMenus()},selectTopic:function(a){this.mediaPlayer.play("select",0);var b=$(a.currentTarget);this.model.set("selectedTopic",b.attr("data-topic")),this.model.selectionDone()&&this.hideAllMenus()},updateContentPage:function(){if(this.model.selectionDone()){this.model.save();var a=this,b=rs.settings.selectedLanguage();this.model.loadContentPage(b).done(function(b){var c=a.model.get("selectedCountry"),d=a.model.get("selectedTopic"),e=c;a.$(".selected-country").text(rs.t("country."+e));var f=_.findWhere(rs.dataLoader.get("topics"),{topic_id:d}).string_id;a.$(".selected-topic").text(rs.t("topic."+f)),$(".content-page").attr({"data-topic":d,"data-country":c}),b=b.replace(/\/internet/g,"internet"),a.$(".content-page").html(b)})}},backToHome:function(){this.mediaPlayer.play("select",0)}}),rs.views.LoadingView=Backbone.View.extend({initialize:function(){this.template=rs.templateLoader.get("loading"),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:function(){}}),rs.views.MemoryView=rs.views.BasicGameView.extend({initialize:function(){rs.views.BasicGameView.prototype.initialize.apply(this),this.model=new rs.models.MemoryModel,this.template=rs.templateLoader.get("memory/memory"),this.render();var a=this;_.defer(function(){a.appendCardsToDOM(),a.showPageMenu()}),this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["select","easy","medium","hard","play","countdown","flip","match","nomatch","timer_15","timer_30","timer_60","memory_win","memory_lose","score"])},onRemove:function(){this.mediaPlayer.release()},render:function(){var a={currentRoute:Backbone.history.fragment};return this.$el.html(this.template(a)),this.$el.i18n(),this},events:function(){return _.extend({},rs.views.BasicGameView.prototype.events,{"click #play":"play","click #cards li:not(.won)":"flipCard","click #memory .page-controls .levels li":"switchCardsNumber","click .back-to-home":"stopTimer","click button.pause":"pause","click div#pause-screen":"resume","click a.back-to-home":"exit","click a.home-btn":"exit","click a.try-again-btn":"exit"})},exit:function(){this.mediaPlayer.play("select",0)},play:function(a){this.mediaPlayer.play("play",0);var b=parseInt(this.$("#cards").attr("data-cards-number"));this.model.setupBoard(b);for(var c=0;b>c;c++){var d=this.model.images()[this.model.board()[c]],e=this.$("#cards li[data-card-index="+c+"] .picture");e.css("background","url(img/memory/"+d+")")}this.showCards(a)},flipCard:function(a){var b=$(a.currentTarget);if(!b.hasClass("flipped")&&2!==this.$("#cards li.flipped:not(.won)").size()){this.mediaPlayer.play("flip",0);var c=this.$("#cards li.flipped:not(.won)");if(b.addClass("flipped"),0!==c.size()){var d=c.data("card-index"),e=b.data("card-index");if(this.model.matches(d,e)){var f=this;this.mediaPlayer.play("match",400),this.allCardsFlipped()&&this.stopTimer();var g=this.$("#cards li.flipped:not(.won)");setTimeout(function(){g.addClass("already-turned").find(".win-overlay").fadeIn(100),g.find(".win-overlay").promise().done(function(){setTimeout(function(){g.addClass("won"),$(".win-overlay").hide(),f.allCardsFlipped()&&f.wonGame()},100)})},500)}else{var f=this;this.mediaPlayer.play("nomatch",550),setTimeout(function(){c.removeClass("flipped"),b.removeClass("flipped")},800)}}}},allCardsFlipped:function(){return 0===this.$("#cards li:not(.flipped)").size()},wonCards:function(){return this.$("#cards li.won")},setupAndStartTimer:function(){var a,b=this.model.cardCount();6===b?(this.timerSound=this.mediaPlayer.play("timer_15",0),a=15):12===b?(this.timerSound=this.mediaPlayer.play("timer_30",0),a=30):24===b&&(this.timerSound=this.mediaPlayer.play("timer_60",0),a=60);var c=this,d=this.$("#car-progress"),e=this.$("#progress").width()-95;this.timer=TweenLite.to(d,a,{css:{x:e,y:0,z:0},ease:Linear.easeNone,onComplete:function(){c.timerSound.stop(),c.lostGame()}})},stopTimer:function(){void 0!==this.timer&&(this.timer.pause(),this.timerSound.stop())},pause:function(){this.mediaPlayer.play("select",0),this.timer.pause(),this.timerSound.pause()},resume:function(){this.mediaPlayer.play("select",0),this.timer.play(),this.timerSound.play()},showCards:function(a){a.preventDefault();var b=this,c=0,d=70;$("#progress").removeClass("animate-1"),$(".cards-icon, .text, .page-controls, #play span, .page-icon","#memory").addClass("animate-1"),setTimeout(function(){$(".scrollable").hide()},200),setTimeout(function(){b.$("#cards").show().find("li").each(function(){c+=d;var a=$(this);setTimeout(function(){a.removeClass("animate-1"),0===b.$("#cards").find("li.animate-1").length&&b.showCounter()},c)})},600)},showCounter:function(){this.mediaPlayer.play("countdown",800);var a,b,c=200,d=1e3-c,e=$("#info"),f=rs.t("game.start"),g=this;rs.slider.disableInteraction(),a=setInterval(function(){e.removeClass("animate-1"),b=setTimeout(function(){clearTimeout(b),e.addClass("animate-1"),setTimeout(function(){var b=e.text();e.text(b-1),1==b&&e.text(f),b==f&&(clearInterval(a),$("#game-overlay").hide(),g.setupAndStartTimer(),rs.slider.enableInteraction())},2*c)},d)},d)},wonGame:function(){this.mediaPlayer.play("memory_win",0);var a=rs.t("game.you_win");this.endGame(a)},lostGame:function(){this.mediaPlayer.play("memory_lose",0);var a=rs.t("game.you_lose");this.endGame(a)},endGame:function(a){var b=a,c=$("#info"),d=this;rs.slider.disableInteraction(),$("#game-overlay").show(),setTimeout(function(){c.css("font-size","70px").text(b).removeClass("animate-1"),setTimeout(function(){c.addClass("animate-1"),setTimeout(function(){$("#cards li").addClass("animate-1"),setTimeout(function(){d.computeAndSetScores(),$("#progress").addClass("animate-1"),$("#final-scores").show(),setTimeout(function(){d.mediaPlayer.play("score",0),$("#final-scores").find(".animate-1").removeClass("animate-1"),$(".bottom-menu").removeClass("animate-1");var a=parseInt(d.$(".your-final-score").text());d.$(".your-final-score").text(0),app.animateNumbers($(".your-final-score"),a,!0,1800),rs.slider.enableInteraction()},1e3)})},300)},2e3)},200)},computeAndSetScores:function(){var a=this.timer.time(),b=this.timer.duration()-a,c=this.wonCards().size(),d=1e3*c+Math.round(100*b),e=Math.floor(a)+" "+rs.t("game.secondes"),f=this.model.highScore(d);this.$("#your-score .number").text(d),this.$("#high-score .number").text(f),this.$("#time .number").text(e)},switchCardsNumber:function(a){var b=$(a.currentTarget),c=b.data("level");switch(parseInt(c)){case 24:this.mediaPlayer.play("hard",0),itemsPerRow=4;break;case 12:this.mediaPlayer.play("medium",0),itemsPerRow=3;break;case 6:this.mediaPlayer.play("easy",0),itemsPerRow=2}this.$("#cards").attr("data-cards-number",c),this.appendCardsToDOM(c)},appendCardsToDOM:function(a){var b=rs.templateLoader.get("memory/_card"),c=this.$("#cards"),d=c.data("cards-number");a&&(d=a);var e,f,g,h=c.find("ul"),j=c.outerHeight()-parseInt(c.css("top"));switch(d){case 24:e=4;break;case 12:e=3;break;case 6:e=2}for(f=d/e,g=j/f,h.empty(),i=0;d>i;i++){var k={filename:"car1.png",cardIndex:i};h.append($(b(k)).height(g))}}}),rs.views.ModeView=Backbone.View.extend({initialize:function(){this.template=rs.templateLoader.get("quiz/mode"),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:{"click .solo-btn a":"startSolo","click .multiplayer-btn a":"startMulti","click a.back-to-home":"backToHome"},startSolo:function(a){a.preventDefault(),this.trigger("soloSelected")},startMulti:function(a){a.preventDefault(),this.trigger("multiSelected")},backToHome:function(){this.trigger("backToHome")}}),rs.views.QuestionView=rs.views.BasicGameView.extend({initialize:function(){rs.views.BasicGameView.prototype.initialize.apply(this),this.template=rs.templateLoader.get("quiz/question"),this.render(),this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["select","timer_15","good_answer","bad_answer"])},onRemove:function(){this.mediaPlayer.release()},render:function(){var a={currentRoute:Backbone.history.fragment};return this.$el.html(this.template(a)),this.$el.i18n(),this},events:function(){return _.extend({},rs.views.BasicGameView.prototype.events,{"click li[data-answer]":"answer","click .back-to-home":"backToHome","click button.pause":"pause","click div#pause-screen":"resume"})},backToHome:function(){this.stopTimer(),this.mediaPlayer.play("select",0)},checkImage:function(){var a=this.$("#question-zone");0===a.find("img").length&&a.addClass("no-image")},setPlayerName:function(a){""===a?this.$("#question-zone .player-bar").remove():this.$("#question-zone .player-name").text(a)},setQuestion:function(a){if(this.$("#question-zone .question-text").text(a.question),""===a.image)this.$("#question-zone img").remove();else{var b="assets/quiz/images/";this.$("#question-zone img").attr("src",b+a.image)}this.checkImage(),this.$('li[data-answer="1"] .answer-text').text(a.answers[0]),this.$('li[data-answer="2"] .answer-text').text(a.answers[1]),this.$('li[data-answer="3"] .answer-text').text(a.answers[2])},setNumberOfQuestions:function(a){this.$(".number-2").text(a)},setQuestionNumber:function(a){this.$(".number-1").text(a)},highlightCorrect:function(a){this.$('li[data-answer="'+a+'"]').addClass("correct")},highlightWrong:function(a){this.$('li[data-answer="'+a+'"]').addClass("wrong")},playGoodAnswerSound:function(){this.mediaPlayer.play("good_answer",0)},playBadAnswerSound:function(){this.mediaPlayer.play("bad_answer",0)},clearHighlights:function(){this.$("li[data-answer]").removeClass("correct"),this.$("li[data-answer]").removeClass("wrong")},answer:function(a){this.stopTimer();var b=$(a.currentTarget),c=b.data("answer");this.trigger("answered",c)},setupAndStartTimer:function(){var a=15;this.timerSound=this.mediaPlayer.play("timer_15",0);var b=this,c=this.$("#car-progress"),d=this.$("#progress").width()-135;this.timer=TweenLite.to(c,a,{css:{x:d,y:0,z:0},ease:Linear.easeNone,onComplete:function(){b.timeout()}})},timeout:function(){this.trigger("answered",null),this.timerSound.stop()},stopTimer:function(){void 0!==this.timer&&(this.timer.pause(),this.timerSound.stop())},pause:function(){this.mediaPlayer.play("select",0),this.timer.pause(),this.timerSound.pause()},resume:function(){this.mediaPlayer.play("select",0),this.timer.play(),this.timerSound.play()}}),rs.views.QuizView=Backbone.View.extend({initialize:function(){this.model=new rs.models.QuizModel,this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["solo","multi","select"]),this.render()},onRemove:function(){this.mediaPlayer.release()},render:function(){var a=new rs.views.ModeView;return this.listenTo(a,"soloSelected",this.startSolo),this.listenTo(a,"multiSelected",this.startMulti),this.listenTo(a,"backToHome",this.backToHome),this.$el=a.$el,this},backToHome:function(){this.mediaPlayer.play("select",0)},startSolo:function(){this.mediaPlayer.play("solo",0);var a=this.model.setupGame({playerCount:1}),b=this;a.done(function(){b.nextQuestion()})},nextQuestion:function(){var a=this.model.nextQuestion();if(null!==a){this.questionView=new rs.views.QuestionView,this.questionView.setQuestion(a),this.questionView.setNumberOfQuestions(this.model.questionCount()),this.questionView.setQuestionNumber(this.model.currentQuestionIndex()+1),this.questionView.setPlayerName(this.model.isMulti()?this.model.currentPlayer().name():"");var b=this;rs.slider.slideViewFrom(this.questionView,"right").done(function(){b.listenTo(b.questionView,"answered",b.answerQuestion)}),this.questionView.setupAndStartTimer()}else if(this.model.isSolo())this.resultSolo();else{var c=this.model.nextPlayer();null!==c?this.switchPlayer(c):this.resultMulti()}},answerQuestion:function(a){this.model.answer(a);var b=this.model.currentQuestion();this.questionView.highlightCorrect(b.correct_answer),a==b.correct_answer?this.questionView.playGoodAnswerSound():(this.questionView.playBadAnswerSound(),this.questionView.highlightWrong(a));var c=this;rs.slider.disableInteraction(),setTimeout(function(){rs.slider.enableInteraction(),c.nextQuestion()},1e3)},startMulti:function(){this.mediaPlayer.play("multi",0);var a=new rs.views.ChoosePlayersView,b=this;rs.slider.slideViewFrom(a,"right").done(function(){b.listenTo(a,"playMulti",b.playMulti)})},playMulti:function(a){if(a.length>=2){var b=this.model.setupGame({playerCount:a.length,players:a}),c=this;b.done(function(){c.switchPlayer(c.model.currentPlayer())})}},switchPlayer:function(a){var b=new rs.views.SwitchPlayerView({players:this.model.players()});b.selectPlayer(a.id);var c=this;rs.slider.slideViewFrom(b,"right").done(function(){c.listenTo(b,"playerReady",function(){c.model.loadNextQuestions().done(function(){c.nextQuestion()})})})},resultSolo:function(){var a=new rs.views.ResultSoloView,b=this.model.goodAnswerCount(0),c=this.model.questionCount();a.setScore(b,c),rs.slider.slideViewFrom(a,"right")},resultMulti:function(){var a=new rs.views.ResultMultiView,b=this,c=this.model.players(),d=_.sortBy(c,function(a){var c=_.indexOf(b.model.players(),a),d=b.model.goodAnswerCount(c);return 100*d-c});d.reverse();for(var e=0;e<d.length;e++){var f=d[e],g=_.indexOf(b.model.players(),f);a.setPlayerName(e+1,f.name()),a.setPlayerScore(e+1,this.model.goodAnswerCount(g),this.model.questionCount())}for(var e=d.length;6>e;e++)a.hidePlayer(e+1);rs.slider.slideViewFrom(a,"right")}}),rs.views.ResultMultiView=Backbone.View.extend({initialize:function(){this.template=rs.templateLoader.get("quiz/result-multi"),this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["quiz_win","quiz_lose","select"]),this.render()},onRemove:function(){this.mediaPlayer.release()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:{"click a.home-btn":"exit","click a.try-again-btn":"exit"},exit:function(){this.mediaPlayer.play("select")},setPlayerName:function(a,b){this.$('.players-score li[data-position="'+a+'"] .name').text(b)},setPlayerScore:function(a,b,c){1===a&&this.mediaPlayer.play(b>=c/2?"quiz_win":"quiz_lose");var d=b+"/"+c;this.$('.players-score li[data-position="'+a+'"] .good-answers').text(d)},hidePlayer:function(a){var b=this.$('.players-score li[data-position="'+a+'"]');b.find(".name").text(""),b.find(".position").text(""),b.find(".answers").text("")}}),rs.views.ResultSoloView=Backbone.View.extend({initialize:function(){this.template=rs.templateLoader.get("quiz/result-solo"),this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["quiz_win","quiz_lose","select"]),this.render()},onRemove:function(){this.mediaPlayer.release()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:{"click a.back-to-home":"exit","click a.home-btn":"exit","click a.try-again-btn":"exit"},exit:function(){this.mediaPlayer.play("select")},setScore:function(a,b){this.mediaPlayer.play(a>=b/2?"quiz_win":"quiz_lose"),this.$("#result .score").text(a+"/"+b)}}),rs.views.SettingsView=Backbone.View.extend({initialize:function(a){this.model=rs.settings,this.template=rs.templateLoader.get(a.templateName),this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["select"]),this.render();var b=this.model.selectedLanguage();this.$('select[name="language"]').find('option[value="'+b+'"]').prop("selected",!0)},onRemove:function(){this.mediaPlayer.release()},render:function(){var a={languages:rs.dataLoader.get("languages")};return this.$el.html(this.template(a)),this.$el.i18n(),this},events:{'change select[name="language"]':"selectLanguage","click a.learn-more":"openInBrowser","click a.latest-content":"openInBrowser","click .language-icon":"clearData","click a.back-to-home":"backToHome"},selectLanguage:function(a){this.mediaPlayer.play("select",0);var b=$(a.target).val();this.model.set("selectedLanguage",b),this.model.save(),rs.slider.disableInteraction();var c=this;i18n.setLng(b,function(a){rs.t=a,c.$el.i18n(),rs.slider.enableInteraction()})},clearData:function(){console.log("clear data"),localStorage.clear()},openInBrowser:function(a){a.preventDefault();var b=$(a.currentTarget),c=b.attr("href");window.open(c,"_system","location=yes")},backToHome:function(){this.mediaPlayer.play("select",0)}}),rs.views.SwitchPlayerView=Backbone.View.extend({initialize:function(){this.collection=new rs.collections.PlayerCollection,this.collection.fetch(),Handlebars.registerPartial("gamePartial",rs.templateLoader.get("_game-partial")),this.template=rs.templateLoader.get("quiz/switch-player"),this.mediaPlayer=new rs.utils.MediaPlayer,this.mediaPlayer.preload(["play","select"]),this.render(),this.$(".bottom-menu").removeClass("animate-1")},onRemove:function(){this.mediaPlayer.release()},render:function(){var a={currentRoute:"quiz"};this.$el.html(this.template(a)),this.$el.i18n();var b=this;return this.collection.each(function(a){b.setPlayerName(a.id,a.name())}),this},events:{"click .play":"play","click a.home-btn":"exit","click a.try-again-btn":"exit"},exit:function(){this.mediaPlayer.play("select")},play:function(){this.mediaPlayer.play("play",0),this.trigger("playerReady")},setPlayerName:function(a,b){var c=this.$('ul.players-list li[data-player-id="'+a+'"] .name');c.text(b)},selectPlayer:function(a){var b=this.$('ul.players-list li[data-player-id="'+a+'"]');b.addClass("selected")}}),rs.models.InfoModel=Backbone.Model.extend({localStorage:new Backbone.LocalStorage("InfoModel"),defaults:{selectedCountry:null,selectedTopic:null},initialize:function(){},selectionDone:function(){return null!==this.get("selectedCountry")&&null!==this.get("selectedTopic")},loadContentPage:function(a){var b=this.get("selectedCountry"),c=this.get("selectedTopic"),d=this.getContentPagePath(b,c,a);return $.get(d)},getContentPagePath:function(a,b,c){return"assets/rules/"+c+"/"+a+"/"+a+"_"+b+"_"+c+".html"}}),rs.models.MemoryModel=Backbone.Model.extend({initialize:function(){this.set("images",rs.dataLoader.get("memory_images"))},images:function(){return this.get("images")},cardCount:function(){return this.get("cardCount")},board:function(){return this.get("board")},setupBoard:function(a){for(var b=this.images().length,c=[],d=0;b>d;d++)c.push(d);var e=_.sample(c,a/2),f=e.concat(e);f=_.shuffle(f),this.set("cardCount",a),this.set("board",f)},matches:function(a,b){return this.board()[a]===this.board()[b]},highScore:function(a){var b="memory_high_score_"+this.cardCount(),c=localStorage.getItem(b);return(null===c||a>parseInt(c))&&(c=a,localStorage.setItem(b,c)),c}}),rs.models.PlayerModel=Backbone.Model.extend({defaults:{name:null},name:function(){return this.get("name")||"Player "+this.id}}),rs.models.QuizModel=Backbone.Model.extend({defaults:{playerCount:1,players:null,questionCount:5},playerCount:function(){return this.get("playerCount")},players:function(){return this.get("players")},questionCount:function(){return this.get("questionCount")},isSolo:function(){return 1===this.playerCount()},isMulti:function(){return this.playerCount()>1},currentQuestionIndex:function(){return this.nextQuestionIndex-1},currentQuestion:function(){var a=this.nextQuestionIndex-1;return 0>a?null:this.questions[a]},currentPlayer:function(){return this.currentPlayerIndex>=this.playerCount()?null:this.get("players")[this.currentPlayerIndex]},goodAnswerCount:function(a){return this.scores[a]},setupGame:function(a){if(this.set("playerCount",a.playerCount),1===a.playerCount){{[new rs.models.PlayerModel]}this.set("players",a.players)}else this.set("players",a.players);this.currentPlayerIndex=0,this.scores=[];for(var b=0;b<a.playerCount;b++)this.scores[b]=0;var c=this,d=this.questionCount();return this.loadQuestions(d).done(function(a){c.questions=a,c.nextQuestionIndex=0})},loadQuestions:function(a){var b=$.Deferred();return $.get("assets/quiz/en/questions.json",function(c){"string"==typeof c&&(c=JSON.parse(c));var d=_.groupBy(c,function(a){return""===a.image?"text":"image"}),e=Math.round(a/3),f=a-e,g=_.sample(d.text,f).concat(_.sample(d.image,e));b.resolve(_.shuffle(g))}),b.promise()},nextQuestion:function(){if(this.nextQuestionIndex>=this.questionCount())return null;var a=this.questions[this.nextQuestionIndex];return this.nextQuestionIndex+=1,a},answer:function(a){var b=this.currentQuestion();a==b.correct_answer&&(this.scores[this.currentPlayerIndex]+=1)},nextPlayer:function(){return this.currentPlayerIndex+=1,this.currentPlayer()},loadNextQuestions:function(){var a=this,b=$.Deferred(),c=this.loadQuestions(this.questionCount());return c.done(function(c){a.questions=c,a.nextQuestionIndex=0,b.resolve(c)}),b.promise()}}),rs.models.SettingsModel=Backbone.Model.extend({localStorage:new Backbone.LocalStorage("SettingsModel"),defaults:{selectedLanguage:null,soundVolume:.3},initialize:function(){},selectedLanguage:function(){return this.get("selectedLanguage")},soundVolume:function(){return this.get("soundVolume")},selectDefaultLanguage:function(){this.set("selectedLanguage","en")},findMatchingLocale:function(a,b){a=a.toLowerCase();var c=_.find(rs.dataLoader.get("languages"),function(b){return b.locale_id===a||b.string_id===a||b.native_name===a});return c?c.locale_id:b}}),rs.collections.PlayerCollection=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("PlayerCollection"),model:rs.models.PlayerModel,saveAll:function(){this.each(function(a){a.save()
})}});var app={initialize:function(){this.debug=!1,this.debug&&(console.log("Browser debug enabled!"),this.onDeviceReady()),this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},enableTransitions:function(){$("body").removeClass("no-transition")},animateNumbers:function(a,b,c,d,e){var f=a,g=parseInt(f.text().replace(/,/g,""));c=void 0===c?!0:c,$({value:g}).animate({value:b},{duration:void 0==d?1e3:d,easing:void 0==e?"swing":e,step:function(){f.text(Math.floor(this.value)),c&&f.text(f.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "))},complete:function(){parseInt(f.text())!==b&&(f.text(b),c&&f.text(f.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 ")))}})},onDeviceReady:function(){console.log("Device is ready..."),navigator.splashscreen&&setTimeout(function(){navigator.splashscreen.hide()},2e3),FastClick.attach(document.body);var a=this;$(document).on("click",".try-again-btn",function(){Backbone.history.stop(),Backbone.history.start()}),rs.settings=new rs.models.SettingsModel({id:1}),rs.settings.fetch(),null===rs.settings.selectedLanguage()?navigator.globalization?navigator.globalization.getPreferredLanguage(function(b){var c=b.value,d=rs.settings.findMatchingLocale(c,"en");rs.settings.set("selectedLanguage",d),rs.settings.save(),a.bootstrap()},function(){console.log("Error getting language"),rs.settings.selectDefaultLanguage(),rs.settings.save(),a.bootstrap()}):(rs.settings.selectDefaultLanguage(),rs.settings.save(),a.bootstrap()):a.bootstrap()},bootstrap:function(){var a={resGetPath:"assets/locales/__lng__/__ns__.json",fallbackLng:"en",lng:rs.settings.selectedLanguage()};i18n.init(a,function(a){rs.t=a;var b=["loading","home","info","settings","disclaimer","game-choice","memory/memory","memory/_card","quiz/quiz","quiz/mode","quiz/choose-players","quiz/result-solo","quiz/result-multi","quiz/question","quiz/switch-player","_game-partial"],c=["countries","topics","languages","memory_images"];$.when(rs.templateLoader.load(b),rs.dataLoader.load(c)).done(function(){var a=new rs.AppRouter,b=new ViewSlider($("#app"));a.slider=b,rs.router=a,rs.slider=b,Backbone.history.start()})})}};