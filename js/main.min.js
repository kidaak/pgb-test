function PageSlider(a){var b,a=a,c=[];this.slidePage=function(a){var b=c.length,d=window.location.hash;return 0===b?(c.push(d),void this.slidePageFrom(a)):void(d===c[b-2]?(c.pop(),this.slidePageFrom(a,"left")):(c.push(d),this.slidePageFrom(a,"right")))},this.disableInteraction=function(){$("#disable-interaction").show()},this.enableInteraction=function(){$("#disable-interaction").hide()},this.slidePageFrom=function(c,d){if(a.append(c),!b||!d)return c.attr("class","page center"),void(b=c);c.attr("class","page "+d),this.disableInteraction();var e=this;setTimeout(function(){$(".page.left, .page.right").remove(),e.enableInteraction()},450),a[0].offsetWidth,c.attr("class","page transition center"),b.attr("class","page transition "+("left"===d?"right":"left")),b=c}}var RoadSafetyApp=function(){this.initialize=function(){this.models={},this.views={},this.templateLoader=new this.TemplateLoader,this.dataLoader=new this.DataLoader},this.TemplateLoader=function(){this.templates={},this.load=function(a){var b=[],c=this;return $.each(a,function(a,d){b.push($.get("tpl/"+d+".html",function(a){c.templates[d]=Handlebars.compile(a)}))}),$.when.apply(null,b)},this.get=function(a){return this.templates[a]}},this.DataLoader=function(){this.data={},this.load=function(a){var b=[],c=this;return $.each(a,function(a,d){b.push($.get("assets/data/"+d+".json",function(a){"string"==typeof a&&(a=JSON.parse(a)),c.data[d]=a}))}),$.when.apply(null,b)},this.get=function(a){return this.data[a]}},this.initialize()};rs=new RoadSafetyApp,rs.views.BasicGameView=Backbone.View.extend({events:{"click .pause":"showPauseScreen","click .resume":"hidePauseScreen","touchstart .page-controls .levels li":"switchLevelClass","MSPointerDown .page-controls .levels li":"switchLevelClass"},initialize:function(){Handlebars.registerPartial("gamePartial",rs.templateLoader.get("_game-partial"))},showPageMenu:function(){setTimeout(function(){app.enableTransitions(),$(".page-icon").removeClass("animate-1"),setTimeout(function(){$(".page-text, .page-controls").removeClass("animate-1"),setTimeout(function(){$(".page-play-txt").removeClass("animate-1")},100)},100)},300)},showPauseScreen:function(){$("#pause-screen, .scrollable").fadeIn(),$(".bottom-menu").removeClass("animate-1")},hidePauseScreen:function(a){a.preventDefault(),$("#pause-screen, .scrollable").fadeOut(),$(".bottom-menu").addClass("animate-1")},switchLevelClass:function(a){var b=$(a.currentTarget);$(".page-controls .levels li").removeClass("active"),b.addClass("active")}}),rs.views.ChoosePlayersView=Backbone.View.extend({events:{"click .bottom li":"addPlayer","click input":"stopInputPropagation"},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},addPlayer:function(a){var b=$(a.currentTarget);b.find(".playing-container").toggleClass("hidden")},stopInputPropagation:function(a){a.stopPropagation()}}),rs.views.DisclaimerView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.GameChoiceView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.HomeView=Backbone.View.extend({initialize:function(){this.template=rs.templateLoader.get("home"),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.InfoView=Backbone.View.extend({events:{"click .inner-menu h3":"hideSingleMenu","click .inner-menu li":"setActiveLI","click .show-menu, .selected-info":"showSingleMenu","click .inner-content":"hideAllMenus","click .left-menu li":"selectCountry","click .right-menu li":"selectTopic"},initialize:function(){this.model=new rs.models.InfoModel({id:1}),this.model.fetch(),this.listenTo(this.model,"change:selectedCountry",this.updateContentPage),this.listenTo(this.model,"change:selectedTopic",this.updateContentPage),this.template=rs.templateLoader.get("info"),this.render(),this.model.selectionDone()&&(this.updateContentPage(),this.$('.left-menu li[data-country="'+this.model.get("selectedCountry")+'"]').addClass("active"),this.$('.right-menu li[data-topic="'+this.model.get("selectedTopic")+'"]').addClass("active"),this.hideAllMenus())},render:function(){var a={countries:rs.dataLoader.get("countries"),topics:rs.dataLoader.get("topics")};return this.$el.html(this.template(a)),this.$el.i18n(),this},hideAllMenus:function(){this.$(".menu").addClass("hidden")},hideSingleMenu:function(a){if(this.model.selectionDone()){var b=$(a.currentTarget);b.parents(".menu").addClass("hidden")}},showSingleMenu:function(a){var b=$(a.currentTarget);a.stopPropagation(),_.defer(function(){b.hasClass("show-left-menu")&&this.$(".left-menu").removeClass("hidden"),b.hasClass("show-right-menu")&&this.$(".right-menu").removeClass("hidden")})},setActiveLI:function(a){var b=$(a.currentTarget);b.parents(".menu").find("li").removeClass("active"),b.addClass("active")},selectCountry:function(a){var b=$(a.currentTarget);this.model.set("selectedCountry",b.attr("data-country")),this.model.selectionDone()&&this.hideAllMenus()},selectTopic:function(a){var b=$(a.currentTarget);this.model.set("selectedTopic",b.attr("data-topic")),this.model.selectionDone()&&this.hideAllMenus()},updateContentPage:function(){if(this.model.selectionDone()){this.model.save();var a=this,b="en";this.model.loadContentPage(b).done(function(b){var c=a.model.get("selectedCountry"),d=a.model.get("selectedTopic"),e=c;a.$(".selected-country").text(rs.t("country."+e));var f=_.findWhere(rs.dataLoader.get("topics"),{topic_id:d}).string_id;a.$(".selected-topic").text(rs.t("topic."+f)),$(".content-page").attr({"data-topic":d,"data-country":c}),b=b.replace(/\/internet/g,"internet"),a.$(".content-page").html(b)})}}}),rs.views.MemoryView=rs.views.BasicGameView.extend({initialize:function(){rs.views.BasicGameView.prototype.initialize.apply(this),this.model=new rs.models.MemoryModel,this.template=rs.templateLoader.get("memory/memory"),this.render();var a=this;_.defer(function(){a.appendCardsToDOM(),a.showPageMenu()})},render:function(){var a={currentRoute:Backbone.history.fragment};return this.$el.html(this.template(a)),this.$el.i18n(),this},events:function(){return _.extend({},rs.views.BasicGameView.prototype.events,{"click #play":"play","click #cards li:not(.won)":"flipCard","click #memory .page-controls .levels li":"switchCardsNumber","click .back-to-home":"stopTimer"})},play:function(a){var b=this.$("#cards").attr("data-cards-number");this.model.setupBoard(b);for(var c=0;b>c;c++){var d=this.model.images()[this.model.board()[c]],e=this.$("#cards li[data-card-index="+c+"] .picture");e.css("background","url(img/memory/"+d+")")}this.showCards(a)},flipCard:function(a){var b=$(a.currentTarget);if(!b.hasClass("flipped")&&2!==this.$("#cards li.flipped:not(.won)").size()){var c=this.$("#cards li.flipped:not(.won)");if(b.addClass("flipped"),0!==c.size()){var d=c.data("card-index"),e=b.data("card-index");if(this.model.matches(d,e)){this.allCardsFlipped()&&this.stopTimer();var f=this,g=this.$("#cards li.flipped:not(.won)");setTimeout(function(){g.addClass("already-turned").find(".win-overlay").fadeIn(100,function(){setTimeout(function(){g.addClass("won"),$(".win-overlay").hide(),this.allCardsFlipped()&&f.wonGame()},100)})},500)}else setTimeout(function(){c.removeClass("flipped"),b.removeClass("flipped")},800)}}},allCardsFlipped:function(){return 0===this.$("#cards li:not(.flipped)").size()},setupAndStartTimer:function(){var a=2e4,b=30,c=Math.round(a/b),d=70,e=this.$("#progress").width()-95,f=e-d,g=f/c,h=this,i=this.$("#car-progress");this.timer=setInterval(function(){d+=g,d>=e&&(d=e,clearInterval(h.timer),h.lostGame());var a=Modernizr.prefixed("transform");i.get(0).style[a]="translate3d("+d+"px, 0, 0)"},b)},stopTimer:function(){clearInterval(this.timer)},showCards:function(a){a.preventDefault();var b=this,c=0,d=70;$("#progress").removeClass("animate-1"),$(".cards-icon, .text, .page-controls, #play span","#memory").addClass("animate-1"),setTimeout(function(){$(".scrollable").hide()},200),setTimeout(function(){b.$("#cards").show().find("li").each(function(){c+=d;var a=$(this);setTimeout(function(){a.removeClass("animate-1"),0===b.$("#cards").find("li.animate-1").length&&b.showCounter()},c)})},600)},showCounter:function(){var a,b,c=200,d=1e3-c,e=$("#info"),f="Start",g=this;a=setInterval(function(){e.removeClass("animate-1"),b=setTimeout(function(){clearTimeout(b),e.addClass("animate-1"),setTimeout(function(){var b=e.text();e.text(b-1),1==b&&e.text(f),b==f&&(clearInterval(a),$("#game-overlay").hide(),g.setupAndStartTimer())},2*c)},d)},d)},wonGame:function(){var a="You win!",b=$("#info");$("#game-overlay").show(),setTimeout(function(){b.css("font-size","70px").text(a).removeClass("animate-1"),setTimeout(function(){b.addClass("animate-1"),setTimeout(function(){$("#cards li").addClass("animate-1"),setTimeout(function(){$("#progress").addClass("animate-1"),$("#final-scores").show(),setTimeout(function(){$("#final-scores").find(".animate-1").removeClass("animate-1"),$(".bottom-menu").removeClass("animate-1"),app.animateNumbers($(".your-final-score"),1539)},1e3)})},300)},2e3)},200)},lostGame:function(){var a="You lost!",b=$("#info");$("#game-overlay").show(),setTimeout(function(){b.css("font-size","70px").text(a).removeClass("animate-1"),setTimeout(function(){b.addClass("animate-1"),setTimeout(function(){$("#cards li").addClass("animate-1"),setTimeout(function(){$("#progress").addClass("animate-1"),$("#final-scores").show(),setTimeout(function(){$("#final-scores").find(".animate-1").removeClass("animate-1"),$(".bottom-menu").removeClass("animate-1"),app.animateNumbers($(".your-final-score"),1539)},1e3)})},300)},2e3)},200)},switchCardsNumber:function(a){var b=$(a.currentTarget),c=b.data("level");this.$("#cards").attr("data-cards-number",c),this.appendCardsToDOM(c)},appendCardsToDOM:function(a){var b=rs.templateLoader.get("memory/_card"),c=this.$("#cards"),d=c.data("cards-number");a&&(d=a);var e,f,g,h=c.find("ul"),j=c.outerHeight()-parseInt(c.css("top"));switch(d){case 24:e=4;break;case 12:e=3;break;case 6:e=2}for(f=d/e,g=j/f,h.empty(),i=0;d>i;i++){var k={filename:"car1.png",cardIndex:i};h.append($(b(k)).height(g))}}}),rs.views.ModeView=Backbone.View.extend({initialize:function(){this.model=new rs.models.QuizModel,this.template=rs.templateLoader.get("quizz/mode"),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:{"click .solo-btn a":"startSoloGame","click .multiplayer-btn a":"startMultiplayerGame"},startSoloGame:function(a){a.preventDefault(),console.log("Start solo game"),this.undelegateEvents();var b=this;this.model.loadNextSeries().done(function(a){b.series=a,b.questionNumber=0,b.nextQuestion()})},startMultiplayerGame:function(a){a.preventDefault(),console.log("Start multiplayer game")},nextQuestion:function(){if(this.questionNumber>=5)return void this.result();this.questionView=new rs.views.QuestionView,this.listenTo(this.questionView,"answered",this.answerQuestion);var a=this.series[this.questionNumber];this.questionView.setQuestion(a),this.questionView.setQuestionNumber(this.questionNumber+1),rs.slider.slidePageFrom(this.questionView.$el,"right"),this.questionNumber++},answerQuestion:function(a){console.log(a);var b=this.series[this.questionNumber-1];this.questionView.highlightCorrect(b.correct_answer),a==b.correct_answer||this.questionView.highlightWrong(a);var c=this;setTimeout(function(){c.nextQuestion()},1e3)},result:function(){var a=new rs.views.ResultSoloView;rs.slider.slidePageFrom(a.$el,"right")}}),rs.views.QuestionView=rs.views.BasicGameView.extend({initialize:function(){rs.views.BasicGameView.prototype.initialize.apply(this),this.template=rs.templateLoader.get("quizz/question"),this.render(),this.checkImage()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:function(){return _.extend({},rs.views.BasicGameView.prototype.events,{"click li[data-answer]":"answer"})},checkImage:function(){var a=this.$("#question-zone");0===a.find("img").length&&a.addClass("no-image")},setQuestion:function(a){this.$(".question-text").text(a.question),this.$("#question-zone img").remove(),this.$('li[data-answer="1"] .answer-text').text(a.answers[0]),this.$('li[data-answer="2"] .answer-text').text(a.answers[1]),this.$('li[data-answer="3"] .answer-text').text(a.answers[2])},setNumberOfQuestions:function(a){this.$(".number-2").text(a)},setQuestionNumber:function(a){this.$(".number-1").text(a)},highlightCorrect:function(a){this.$('li[data-answer="'+a+'"]').addClass("correct")},highlightWrong:function(a){this.$('li[data-answer="'+a+'"]').addClass("wrong")},clearHighlights:function(){this.$("li[data-answer]").removeClass("correct"),this.$("li[data-answer]").removeClass("wrong")},answer:function(a){var b=$(a.currentTarget),c=b.data("answer");this.trigger("answered",c)}}),rs.views.QuizView=rs.views.BasicGameView.extend({initialize:function(){this.template=rs.templateLoader.get("quizz/quizz"),this.render();var a=this;_.defer(function(){a.showPageMenu()})},render:function(){var a={currentRoute:Backbone.history.fragment};return this.$el.html(this.template(a)),this.$el.i18n(),this},events:{}}),rs.views.ResultMultiView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.ResultSoloView=Backbone.View.extend({events:{},initialize:function(){this.template=rs.templateLoader.get("quizz/result-solo"),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.SettingsView=Backbone.View.extend({initialize:function(a){this.model=rs.settings,this.template=rs.templateLoader.get(a.templateName),this.render();var b=this.model.selectedLanguage();this.$('select[name="language"]').find('option[value="'+b+'"]').prop("selected",!0)},render:function(){var a={languages:rs.dataLoader.get("languages")};return this.$el.html(this.template(a)),this.$el.i18n(),this},events:{'change select[name="language"]':"selectLanguage"},selectLanguage:function(a){var b=$(a.target).val();this.model.set("selectedLanguage",b),this.model.save(),rs.slider.disableInteraction();var c=this;i18n.setLng(b,function(a){rs.t=a,c.$el.i18n(),rs.slider.enableInteraction()})}}),rs.views.SwitchPlayerView=Backbone.View.extend({events:{},initialize:function(a){Handlebars.registerPartial("gamePartial",rs.templateLoader.get("_game-partial")),this.template=rs.templateLoader.get(a.templateName),this.render(),this.$(".bottom-menu").removeClass("animate-1")},render:function(){var a={currentRoute:"mode"};return this.$el.html(this.template(a)),this.$el.i18n(),this}}),rs.models.InfoModel=Backbone.Model.extend({localStorage:new Backbone.LocalStorage("InfoModel"),defaults:{selectedCountry:null,selectedTopic:null},initialize:function(){},selectionDone:function(){return null!==this.get("selectedCountry")&&null!==this.get("selectedTopic")},loadContentPage:function(a){var b=this.get("selectedCountry"),c=this.get("selectedTopic"),d=this.getContentPagePath(b,c,a);return $.get(d)},getContentPagePath:function(a,b,c){return"assets/rules/"+c+"/"+a+"/"+a+"_"+b+"_"+c+".html"}}),rs.models.MemoryModel=Backbone.Model.extend({initialize:function(){this.set("images",rs.dataLoader.get("memory_images"))},images:function(){return this.get("images")},cardCount:function(){return this.get("cardCount")},board:function(){return this.get("board")},setupBoard:function(a){for(var b=this.images().length,c=[],d=0;b>d;d++)c.push(d);var e=_.sample(c,a/2),f=e.concat(e);f=_.shuffle(f),this.set("cardCount",a),this.set("board",f)},matches:function(a,b){return this.board()[a]===this.board()[b]}}),rs.models.PlayerProfileModel=Backbone.Model.extend({}),rs.models.QuizModel=Backbone.Model.extend({defaults:{seriesLength:15},seriesLength:function(){return this.get("seriesLength")},loadNextSeries:function(){for(var a=[],b=[],c=this.seriesLength(),d=0;c>d;d++)b.push(this.loadNextQuestion().done(function(b){a.push(b)}));var e=$.Deferred();return $.when.apply(null,b).done(function(){e.resolve(a)}),e.promise()},loadNextQuestion:function(){var a=$.Deferred();return $.get("assets/quiz/en/questions.json",function(b){"string"==typeof b&&(b=JSON.parse(b)),a.resolve(_.sample(b))}),a.promise()}}),rs.models.SettingsModel=Backbone.Model.extend({localStorage:new Backbone.LocalStorage("SettingsModel"),defaults:{selectedLanguage:"en"},initialize:function(){},selectedLanguage:function(){return this.get("selectedLanguage")}});var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},enableTransitions:function(){$("body").removeClass("no-transition")},animateNumbers:function(a,b,c,d,e){var f=a,g=parseInt(f.text().replace(/,/g,""));c=void 0===c?!0:c,$({value:g}).animate({value:b},{duration:void 0==d?1e3:d,easing:void 0==e?"swing":e,step:function(){f.text(Math.floor(this.value)),c&&f.text(f.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "))},complete:function(){parseInt(f.text())!==b&&(f.text(b),c&&f.text(f.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 ")))}})},onDeviceReady:function(){console.log("Device is ready..."),FastClick.attach(document.body);$(document).on("click",".try-again-btn",function(){Backbone.history.stop(),Backbone.history.start()});var a=Backbone.Router.extend({routes:{"":"home",settings:"settings",info:"info",disclaimer:"disclaimer","game-choice":"gameChoice",memory:"memory",mode:"mode","choose-players":"choosePlayers","result-solo":"resultSolo","result-multi":"resultMulti",question:"question","switch-player":"switchPlayer"},initialize:function(){this.bind("all",this.change)},change:function(){$("body").addClass("no-transition")},home:function(){var a=new rs.views.HomeView;this.slider.slidePage(a.$el)},settings:function(){var a=new rs.views.SettingsView({templateName:"settings"});this.slider.slidePage(a.$el)},info:function(){var a=new rs.views.InfoView;this.slider.slidePage(a.$el)},disclaimer:function(){var a=new rs.views.InfosView({templateName:"disclaimer"});this.slider.slidePage(a.$el)},gameChoice:function(){var a=new rs.views.GameChoiceView({templateName:"game-choice"});this.slider.slidePage(a.$el)},memory:function(){var a=new rs.views.MemoryView;this.slider.slidePage(a.$el)},mode:function(){var a=new rs.views.ModeView;this.slider.slidePage(a.$el)},choosePlayers:function(){var a=new rs.views.ChoosePlayersView({templateName:"quizz/choose-players"});this.slider.slidePage(a.$el)},resultSolo:function(){var a=new rs.views.ResultMultiView;this.slider.slidePage(a.$el)},resultMulti:function(){var a=new rs.views.ResultMultiView({templateName:"quizz/result-multi"});this.slider.slidePage(a.$el)},question:function(){var a=new rs.views.QuestionView;this.slider.slidePage(a.$el)},switchPlayer:function(){var a=new rs.views.SwitchPlayerView({templateName:"quizz/switch-player"});this.slider.slidePage(a.$el)}});rs.settings=new rs.models.SettingsModel({id:1}),rs.settings.fetch();var b={resGetPath:"assets/locales/__lng__/__ns__.json",fallbackLng:"en",lng:rs.settings.selectedLanguage()};i18n.init(b,function(b){rs.t=b;var c=["home","info","settings","disclaimer","game-choice","memory/memory","memory/_card","quizz/quizz","quizz/mode","quizz/choose-players","quizz/result-solo","quizz/result-multi","quizz/question","quizz/switch-player","_game-partial"],d=["countries","topics","languages","memory_images"];$.when(rs.templateLoader.load(c),rs.dataLoader.load(d)).done(function(){var b=new a,c=new PageSlider($("#app"));b.slider=c,rs.router=b,rs.slider=c,Backbone.history.start()})})}};