function PageSlider(a){var b,a=a,c=[];this.slidePage=function(a){var b=c.length,d=window.location.hash;return 0===b?(c.push(d),void this.slidePageFrom(a)):void(d===c[b-2]?(c.pop(),this.slidePageFrom(a,"left")):(c.push(d),this.slidePageFrom(a,"right")))},this.disableInteraction=function(){$("#disable-interaction").show()},this.enableInteraction=function(){$("#disable-interaction").hide()},this.slidePageFrom=function(c,d){if(a.append(c),!b||!d)return c.attr("class","page center"),void(b=c);c.attr("class","page "+d),this.disableInteraction();var e=this;setTimeout(function(){$(".page.left, .page.right").remove(),e.enableInteraction()},450),a[0].offsetWidth,c.attr("class","page transition center"),b.attr("class","page transition "+("left"===d?"right":"left")),b=c}}var RoadSafetyApp=function(){this.initialize=function(){this.models={},this.collections={},this.views={},this.templateLoader=new this.TemplateLoader,this.dataLoader=new this.DataLoader},this.TemplateLoader=function(){this.templates={},this.load=function(a){var b=[],c=this;return $.each(a,function(a,d){b.push($.get("tpl/"+d+".html",function(a){c.templates[d]=Handlebars.compile(a)}))}),$.when.apply(null,b)},this.get=function(a){return this.templates[a]}},this.DataLoader=function(){this.data={},this.load=function(a){var b=[],c=this;return $.each(a,function(a,d){b.push($.get("assets/data/"+d+".json",function(a){"string"==typeof a&&(a=JSON.parse(a)),c.data[d]=a}))}),$.when.apply(null,b)},this.get=function(a){return this.data[a]}},this.initialize()};rs=new RoadSafetyApp,rs.views.BasicGameView=Backbone.View.extend({events:{"click .pause":"showPauseScreen","click .resume":"hidePauseScreen","touchstart .page-controls .levels li":"switchLevelClass","MSPointerDown .page-controls .levels li":"switchLevelClass"},initialize:function(){Handlebars.registerPartial("gamePartial",rs.templateLoader.get("_game-partial"))},showPageMenu:function(){setTimeout(function(){app.enableTransitions(),$(".page-icon").removeClass("animate-1"),setTimeout(function(){$(".page-text, .page-controls").removeClass("animate-1"),setTimeout(function(){$(".page-play-txt").removeClass("animate-1")},100)},100)},300)},showPauseScreen:function(){$("#pause-screen, .scrollable").fadeIn(),$(".bottom-menu").removeClass("animate-1")},hidePauseScreen:function(a){a.preventDefault(),$("#pause-screen, .scrollable").fadeOut(),$(".bottom-menu").addClass("animate-1")},switchLevelClass:function(a){var b=$(a.currentTarget);$(".page-controls .levels li").removeClass("active"),b.addClass("active")}}),rs.views.ChoosePlayersView=Backbone.View.extend({initialize:function(){if(this.collection=new rs.collections.PlayerCollection,this.collection.fetch(),0===this.collection.length){console.log("create players");for(var a=0;6>a;a++)this.collection.add({id:a+1});this.collection.saveAll()}this.template=rs.templateLoader.get("quiz/choose-players"),this.render()},render:function(){this.$el.html(this.template()),this.$el.i18n(),this.$('input[name="name"]').attr("maxlength","12");var a=this;return this.collection.each(function(b){a.$(".players-list li[data-player-id="+b.id+'] input[name="name"]').val(b.name())}),this.$('.players-list li[data-player-id="1"] .playing-container').toggleClass("hidden"),this.$('.players-list li[data-player-id="2"] .playing-container').toggleClass("hidden"),this},events:{"click .bottom li":"addPlayer","click input":"stopInputPropagation","click #play":"play","input .bottom li":"changeName"},addPlayer:function(a){var b=$(a.currentTarget);b.find(".playing-container").toggleClass("hidden")},stopInputPropagation:function(a){a.stopPropagation()},play:function(a){a.preventDefault(),this.trigger("playMulti",this.selectedPlayers())},changeName:function(a){var b=$(a.currentTarget),c=b.attr("data-player-id"),d=b.find('input[name="name"]').val(),e=this.collection.get(c);e.set("name",d),e.save()},selectedPlayers:function(){var a=[],b=this;return this.$(".bottom li").each(function(){if($(this).find(".playing-container").is(":visible")){var c=$(this).attr("data-player-id"),d=b.collection.get(c);a.push(d)}}),a}}),rs.views.DisclaimerView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.GameChoiceView=Backbone.View.extend({events:{},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.HomeView=Backbone.View.extend({initialize:function(){this.template=rs.templateLoader.get("home"),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}}),rs.views.InfoView=Backbone.View.extend({events:{"click .inner-menu h3":"hideSingleMenu","click .inner-menu li":"setActiveLI","click .show-menu, .selected-info":"showSingleMenu","click .inner-content":"hideAllMenus","click .left-menu li":"selectCountry","click .right-menu li":"selectTopic"},initialize:function(){this.model=new rs.models.InfoModel({id:1}),this.model.fetch(),this.listenTo(this.model,"change:selectedCountry",this.updateContentPage),this.listenTo(this.model,"change:selectedTopic",this.updateContentPage),this.template=rs.templateLoader.get("info"),this.render(),this.model.selectionDone()&&(this.updateContentPage(),this.$('.left-menu li[data-country="'+this.model.get("selectedCountry")+'"]').addClass("active"),this.$('.right-menu li[data-topic="'+this.model.get("selectedTopic")+'"]').addClass("active"),this.hideAllMenus())},render:function(){var a={countries:rs.dataLoader.get("countries"),topics:rs.dataLoader.get("topics")};return this.$el.html(this.template(a)),this.$el.i18n(),this},hideAllMenus:function(){this.$(".menu").addClass("hidden")},hideSingleMenu:function(a){if(this.model.selectionDone()){var b=$(a.currentTarget);b.parents(".menu").addClass("hidden")}},showSingleMenu:function(a){var b=$(a.currentTarget);a.stopPropagation(),_.defer(function(){b.hasClass("show-left-menu")&&this.$(".left-menu").removeClass("hidden"),b.hasClass("show-right-menu")&&this.$(".right-menu").removeClass("hidden")})},setActiveLI:function(a){var b=$(a.currentTarget);b.parents(".menu").find("li").removeClass("active"),b.addClass("active")},selectCountry:function(a){var b=$(a.currentTarget);this.model.set("selectedCountry",b.attr("data-country")),this.model.selectionDone()&&this.hideAllMenus()},selectTopic:function(a){var b=$(a.currentTarget);this.model.set("selectedTopic",b.attr("data-topic")),this.model.selectionDone()&&this.hideAllMenus()},updateContentPage:function(){if(this.model.selectionDone()){this.model.save();var a=this,b="en";this.model.loadContentPage(b).done(function(b){var c=a.model.get("selectedCountry"),d=a.model.get("selectedTopic"),e=c;a.$(".selected-country").text(rs.t("country."+e));var f=_.findWhere(rs.dataLoader.get("topics"),{topic_id:d}).string_id;a.$(".selected-topic").text(rs.t("topic."+f)),$(".content-page").attr({"data-topic":d,"data-country":c}),b=b.replace(/\/internet/g,"internet"),a.$(".content-page").html(b)})}}}),rs.views.MemoryView=rs.views.BasicGameView.extend({initialize:function(){rs.views.BasicGameView.prototype.initialize.apply(this),this.model=new rs.models.MemoryModel,this.template=rs.templateLoader.get("memory/memory"),this.render();var a=this;_.defer(function(){a.appendCardsToDOM(),a.showPageMenu()})},render:function(){var a={currentRoute:Backbone.history.fragment};return this.$el.html(this.template(a)),this.$el.i18n(),this},events:function(){return _.extend({},rs.views.BasicGameView.prototype.events,{"click #play":"play","click #cards li:not(.won)":"flipCard","click #memory .page-controls .levels li":"switchCardsNumber","click .back-to-home":"stopTimer","click button.pause":"pause","click a.resume":"resume"})},play:function(a){var b=parseInt(this.$("#cards").attr("data-cards-number"));this.model.setupBoard(b);for(var c=0;b>c;c++){var d=this.model.images()[this.model.board()[c]],e=this.$("#cards li[data-card-index="+c+"] .picture");e.css("background","url(img/memory/"+d+")")}this.showCards(a)},flipCard:function(a){var b=$(a.currentTarget);if(!b.hasClass("flipped")&&2!==this.$("#cards li.flipped:not(.won)").size()){var c=this.$("#cards li.flipped:not(.won)");if(b.addClass("flipped"),0!==c.size()){var d=c.data("card-index"),e=b.data("card-index");if(this.model.matches(d,e)){this.allCardsFlipped()&&this.stopTimer();var f=this,g=this.$("#cards li.flipped:not(.won)");setTimeout(function(){g.addClass("already-turned").find(".win-overlay").fadeIn(100),g.find(".win-overlay").promise().done(function(){setTimeout(function(){g.addClass("won"),$(".win-overlay").hide(),f.allCardsFlipped()&&(console.log("all cards flipped"),f.wonGame())},100)})},500)}else setTimeout(function(){c.removeClass("flipped"),b.removeClass("flipped")},800)}}},allCardsFlipped:function(){return 0===this.$("#cards li:not(.flipped)").size()},wonCards:function(){return this.$("#cards li.won")},setupAndStartTimer:function(){var a,b=this.model.cardCount();6===b?a=15:12===b?a=30:24===b&&(a=60);var c=this,d=this.$("#car-progress"),e=this.$("#progress").width()-95;this.timer=TweenLite.to(d,a,{css:{x:e,y:0,z:0},ease:Linear.easeNone,onComplete:function(){c.lostGame()}})},stopTimer:function(){void 0!==this.timer&&this.timer.pause()},pause:function(){this.timer.pause()},resume:function(){this.timer.play()},showCards:function(a){a.preventDefault();var b=this,c=0,d=70;$("#progress").removeClass("animate-1"),$(".cards-icon, .text, .page-controls, #play span","#memory").addClass("animate-1"),setTimeout(function(){$(".scrollable").hide()},200),setTimeout(function(){b.$("#cards").show().find("li").each(function(){c+=d;var a=$(this);setTimeout(function(){a.removeClass("animate-1"),0===b.$("#cards").find("li.animate-1").length&&b.showCounter()},c)})},600)},showCounter:function(){var a,b,c=200,d=1e3-c,e=$("#info"),f="Start",g=this;a=setInterval(function(){e.removeClass("animate-1"),b=setTimeout(function(){clearTimeout(b),e.addClass("animate-1"),setTimeout(function(){var b=e.text();e.text(b-1),1==b&&e.text(f),b==f&&(clearInterval(a),$("#game-overlay").hide(),g.setupAndStartTimer())},2*c)},d)},d)},wonGame:function(){this.endGame("You win!")},lostGame:function(){this.endGame("You lost!")},endGame:function(a){var b=a,c=$("#info"),d=this;$("#game-overlay").show(),setTimeout(function(){c.css("font-size","70px").text(b).removeClass("animate-1"),setTimeout(function(){c.addClass("animate-1"),setTimeout(function(){$("#cards li").addClass("animate-1"),setTimeout(function(){d.computeAndSetScores(),$("#progress").addClass("animate-1"),$("#final-scores").show(),setTimeout(function(){$("#final-scores").find(".animate-1").removeClass("animate-1"),$(".bottom-menu").removeClass("animate-1");var a=parseInt(this.$(".your-final-score").text());this.$(".your-final-score").text(0),app.animateNumbers($(".your-final-score"),a)},1e3)})},300)},2e3)},200)},computeAndSetScores:function(){var a=this.timer.time(),b=this.timer.duration()-a,c=this.wonCards().size(),d=1e3*c+Math.round(100*b),e=Math.floor(a)+" sec.",f=this.model.highScore(d);this.$("#your-score .number").text(d),this.$("#high-score .number").text(f),this.$("#time .number").text(e)},switchCardsNumber:function(a){var b=$(a.currentTarget),c=b.data("level");this.$("#cards").attr("data-cards-number",c),this.appendCardsToDOM(c)},appendCardsToDOM:function(a){var b=rs.templateLoader.get("memory/_card"),c=this.$("#cards"),d=c.data("cards-number");a&&(d=a);var e,f,g,h=c.find("ul"),j=c.outerHeight()-parseInt(c.css("top"));switch(d){case 24:e=4;break;case 12:e=3;break;case 6:e=2}for(f=d/e,g=j/f,h.empty(),i=0;d>i;i++){var k={filename:"car1.png",cardIndex:i};h.append($(b(k)).height(g))}}}),rs.views.ModeView=Backbone.View.extend({initialize:function(){this.template=rs.templateLoader.get("quiz/mode"),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:{"click .solo-btn a":"startSolo","click .multiplayer-btn a":"startMulti"},startSolo:function(a){a.preventDefault(),this.trigger("soloSelected")},startMulti:function(a){a.preventDefault(),this.trigger("multiSelected")}}),rs.views.QuestionView=rs.views.BasicGameView.extend({initialize:function(){rs.views.BasicGameView.prototype.initialize.apply(this),this.template=rs.templateLoader.get("quiz/question"),this.render(),this.checkImage()},render:function(){var a={currentRoute:Backbone.history.fragment};return this.$el.html(this.template(a)),this.$el.i18n(),this},events:function(){return _.extend({},rs.views.BasicGameView.prototype.events,{"click li[data-answer]":"answer","click .back-to-home":"stopTimer","click button.pause":"pause","click a.resume":"resume"})},checkImage:function(){var a=this.$("#question-zone");0===a.find("img").length&&a.addClass("no-image")},setPlayerName:function(a){this.$("#question-zone .player-name").text(a)},setQuestion:function(a){this.$("#question-zone .question-text").text(a.question),this.$("#question-zone img").remove(),this.$('li[data-answer="1"] .answer-text').text(a.answers[0]),this.$('li[data-answer="2"] .answer-text').text(a.answers[1]),this.$('li[data-answer="3"] .answer-text').text(a.answers[2])},setNumberOfQuestions:function(a){this.$(".number-2").text(a)},setQuestionNumber:function(a){this.$(".number-1").text(a)},highlightCorrect:function(a){this.$('li[data-answer="'+a+'"]').addClass("correct")},highlightWrong:function(a){this.$('li[data-answer="'+a+'"]').addClass("wrong")},clearHighlights:function(){this.$("li[data-answer]").removeClass("correct"),this.$("li[data-answer]").removeClass("wrong")},answer:function(a){this.stopTimer();var b=$(a.currentTarget),c=b.data("answer");this.trigger("answered",c)},setupAndStartTimer:function(){var a=8,b=this,c=this.$("#car-progress"),d=this.$("#progress").width()-135;this.timer=TweenLite.to(c,a,{css:{x:d,y:0,z:0},ease:Linear.easeNone,onComplete:function(){b.timeout()}})},timeout:function(){this.trigger("answered",null)},stopTimer:function(){void 0!==this.timer&&this.timer.pause()},pause:function(){this.timer.pause()},resume:function(){this.timer.play()}}),rs.views.QuizView=rs.views.BasicGameView.extend({initialize:function(){this.model=new rs.models.QuizModel,this.render()},render:function(){var a=new rs.views.ModeView;return this.listenTo(a,"soloSelected",this.startSolo),this.listenTo(a,"multiSelected",this.startMulti),this.$el=a.$el,this},startSolo:function(){var a=this.model.setupGame({playerCount:1}),b=this;a.done(function(){b.nextQuestion()})},nextQuestion:function(){var a=this.model.nextQuestion();if(null!==a)this.questionView=new rs.views.QuestionView,this.listenTo(this.questionView,"answered",this.answerQuestion),this.questionView.setQuestion(a),this.questionView.setNumberOfQuestions(this.model.questionCount()),this.questionView.setQuestionNumber(this.model.currentQuestionIndex()+1),this.questionView.setPlayerName(this.model.isMulti()?this.model.currentPlayer().name():""),rs.slider.slidePageFrom(this.questionView.$el,"right"),this.questionView.setupAndStartTimer();else if(this.model.isSolo())this.resultSolo();else{var b=this.model.nextPlayer();null!==b?this.switchPlayer(b):this.resultMulti()}},answerQuestion:function(a){this.model.answer(a);var b=this.model.currentQuestion();this.questionView.highlightCorrect(b.correct_answer),a==b.correct_answer||this.questionView.highlightWrong(a);var c=this;rs.slider.disableInteraction(),setTimeout(function(){rs.slider.enableInteraction(),c.nextQuestion()},1e3)},startMulti:function(){var a=new rs.views.ChoosePlayersView;this.listenTo(a,"playMulti",this.playMulti),rs.slider.slidePageFrom(a.$el,"right")},playMulti:function(a){if(a.length>=2)var b=this.model.setupGame({playerCount:a.length,players:a});var c=this;b.done(function(){c.switchPlayer(c.model.currentPlayer())})},switchPlayer:function(a){var b=new rs.views.SwitchPlayerView({players:this.model.players()});b.selectPlayer(a.id);var c=this;this.listenTo(b,"playerReady",function(){c.model.loadNextQuestions().done(function(){c.nextQuestion()})}),rs.slider.slidePageFrom(b.$el,"right")},resultSolo:function(){var a=new rs.views.ResultSoloView,b=this.model.goodAnswerCount(0),c=this.model.questionCount();a.setScore(b,c),rs.slider.slidePageFrom(a.$el,"right")},resultMulti:function(){var a=new rs.views.ResultMultiView,b=this,c=this.model.players(),d=_.sortBy(c,function(a){var c=_.indexOf(b.model.players(),a),d=b.model.goodAnswerCount(c);return 100*d-c});d.reverse();for(var e=0;e<d.length;e++){var f=d[e],g=_.indexOf(b.model.players(),f);a.setPlayerName(e+1,f.name()),a.setPlayerScore(e+1,this.model.goodAnswerCount(g),this.model.questionCount())}for(var e=d.length;6>e;e++)a.hidePlayer(e+1);rs.slider.slidePageFrom(a.$el,"right")}}),rs.views.ResultMultiView=Backbone.View.extend({initialize:function(){this.template=rs.templateLoader.get("quiz/result-multi"),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:{},setPlayerName:function(a,b){this.$('.players-score li[data-position="'+a+'"] .name').text(b)},setPlayerScore:function(a,b,c){var d=b+"/"+c;this.$('.players-score li[data-position="'+a+'"] .good-answers').text(d)},hidePlayer:function(a){var b=this.$('.players-score li[data-position="'+a+'"]');b.find(".name").text(""),b.find(".position").text(""),b.find(".answers").text("")}}),rs.views.ResultSoloView=Backbone.View.extend({initialize:function(){this.template=rs.templateLoader.get("quiz/result-solo"),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},events:{},setScore:function(a,b){this.$("#result .score").text(a+"/"+b)}}),rs.views.SettingsView=Backbone.View.extend({initialize:function(a){this.model=rs.settings,this.template=rs.templateLoader.get(a.templateName),this.render();var b=this.model.selectedLanguage();this.$('select[name="language"]').find('option[value="'+b+'"]').prop("selected",!0)},render:function(){var a={languages:rs.dataLoader.get("languages")};return this.$el.html(this.template(a)),this.$el.i18n(),this},events:{'change select[name="language"]':"selectLanguage"},selectLanguage:function(a){var b=$(a.target).val();this.model.set("selectedLanguage",b),this.model.save(),rs.slider.disableInteraction();var c=this;i18n.setLng(b,function(a){rs.t=a,c.$el.i18n(),rs.slider.enableInteraction()})}}),rs.views.SwitchPlayerView=Backbone.View.extend({initialize:function(){this.collection=new rs.collections.PlayerCollection,this.collection.fetch(),Handlebars.registerPartial("gamePartial",rs.templateLoader.get("_game-partial")),this.template=rs.templateLoader.get("quiz/switch-player"),this.render(),this.$(".bottom-menu").removeClass("animate-1")},render:function(){var a={currentRoute:"quiz"};this.$el.html(this.template(a)),this.$el.i18n();var b=this;return this.collection.each(function(a){b.setPlayerName(a.id,a.name())}),this},events:{"click .play":"play"},play:function(){this.trigger("playerReady")},setPlayerName:function(a,b){var c=this.$('ul.players-list li[data-player-id="'+a+'"] .name');c.text(b)},selectPlayer:function(a){var b=this.$('ul.players-list li[data-player-id="'+a+'"]');b.addClass("selected")}}),rs.models.InfoModel=Backbone.Model.extend({localStorage:new Backbone.LocalStorage("InfoModel"),defaults:{selectedCountry:null,selectedTopic:null},initialize:function(){},selectionDone:function(){return null!==this.get("selectedCountry")&&null!==this.get("selectedTopic")},loadContentPage:function(a){var b=this.get("selectedCountry"),c=this.get("selectedTopic"),d=this.getContentPagePath(b,c,a);return $.get(d)},getContentPagePath:function(a,b,c){return"assets/rules/"+c+"/"+a+"/"+a+"_"+b+"_"+c+".html"}}),rs.models.MemoryModel=Backbone.Model.extend({initialize:function(){this.set("images",rs.dataLoader.get("memory_images"))},images:function(){return this.get("images")},cardCount:function(){return this.get("cardCount")},board:function(){return this.get("board")},setupBoard:function(a){for(var b=this.images().length,c=[],d=0;b>d;d++)c.push(d);var e=_.sample(c,a/2),f=e.concat(e);f=_.shuffle(f),this.set("cardCount",a),this.set("board",f)},matches:function(a,b){return this.board()[a]===this.board()[b]},highScore:function(a){var b="memory_high_score_"+this.cardCount(),c=localStorage.getItem(b);return(null===c||a>parseInt(c))&&(c=a,localStorage.setItem(b,c)),c}}),rs.models.PlayerModel=Backbone.Model.extend({defaults:{name:null},name:function(){return this.get("name")||"Player "+this.id}}),rs.models.QuizModel=Backbone.Model.extend({defaults:{playerCount:1,players:null,questionCount:5},playerCount:function(){return this.get("playerCount")},players:function(){return this.get("players")},questionCount:function(){return this.get("questionCount")},isSolo:function(){return 1===this.playerCount()},isMulti:function(){return this.playerCount()>1},currentQuestionIndex:function(){return this.nextQuestionIndex-1},currentQuestion:function(){var a=this.nextQuestionIndex-1;return 0>a?null:this.questions[a]},currentPlayer:function(){return this.currentPlayerIndex>=this.playerCount()?null:this.get("players")[this.currentPlayerIndex]},goodAnswerCount:function(a){return this.scores[a]},setupGame:function(a){if(this.set("playerCount",a.playerCount),1===a.playerCount){{[new rs.models.PlayerModel]}this.set("players",a.players)}else this.set("players",a.players);this.currentPlayerIndex=0,this.scores=[];for(var b=0;b<a.playerCount;b++)this.scores[b]=0;var c=this,d=this.questionCount();return this.loadQuestions(d).done(function(a){c.questions=a,c.nextQuestionIndex=0})},loadQuestions:function(a){var b=$.Deferred();return $.get("assets/quiz/en/questions.json",function(c){"string"==typeof c&&(c=JSON.parse(c)),b.resolve(_.sample(c,a))}),b.promise()},nextQuestion:function(){if(this.nextQuestionIndex>=this.questionCount())return null;var a=this.questions[this.nextQuestionIndex];return this.nextQuestionIndex+=1,a},answer:function(a){var b=this.currentQuestion();a==b.correct_answer&&(this.scores[this.currentPlayerIndex]+=1)},nextPlayer:function(){return this.currentPlayerIndex+=1,this.currentPlayer()},loadNextQuestions:function(){var a=this,b=$.Deferred();return $.get("assets/quiz/en/questions.json",function(c){"string"==typeof c&&(c=JSON.parse(c));var d=_.sample(c,a.questionCount());a.questions=d,a.nextQuestionIndex=0,b.resolve(d)}),b.promise()}}),rs.models.SettingsModel=Backbone.Model.extend({localStorage:new Backbone.LocalStorage("SettingsModel"),defaults:{selectedLanguage:"en"},initialize:function(){},selectedLanguage:function(){return this.get("selectedLanguage")}}),rs.collections.PlayerCollection=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("PlayerCollection"),model:rs.models.PlayerModel,saveAll:function(){this.each(function(a){a.save()})}});var app={initialize:function(){this.debug=!0,this.debug&&(console.log("Browser debug enabled!"),this.onDeviceReady()),this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},enableTransitions:function(){$("body").removeClass("no-transition")},animateNumbers:function(a,b,c,d,e){var f=a,g=parseInt(f.text().replace(/,/g,""));c=void 0===c?!0:c,$({value:g}).animate({value:b},{duration:void 0==d?1e3:d,easing:void 0==e?"swing":e,step:function(){f.text(Math.floor(this.value)),c&&f.text(f.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "))},complete:function(){parseInt(f.text())!==b&&(f.text(b),c&&f.text(f.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 ")))}})},onDeviceReady:function(){console.log("Device is ready..."),FastClick.attach(document.body);$(document).on("click",".try-again-btn",function(){Backbone.history.stop(),Backbone.history.start()});var a=Backbone.Router.extend({routes:{"":"home",settings:"settings",info:"info",disclaimer:"disclaimer","game-choice":"gameChoice",memory:"memory",quiz:"quiz"},initialize:function(){this.bind("all",this.change)},change:function(){$("body").addClass("no-transition")},home:function(){var a=new rs.views.HomeView;this.slider.slidePage(a.$el)},settings:function(){var a=new rs.views.SettingsView({templateName:"settings"});this.slider.slidePage(a.$el)},info:function(){var a=new rs.views.InfoView;this.slider.slidePage(a.$el)},disclaimer:function(){var a=new rs.views.InfosView({templateName:"disclaimer"});this.slider.slidePage(a.$el)},gameChoice:function(){var a=new rs.views.GameChoiceView({templateName:"game-choice"});this.slider.slidePage(a.$el)},memory:function(){var a=new rs.views.MemoryView;this.slider.slidePage(a.$el)},quiz:function(){var a=new rs.views.QuizView;this.slider.slidePage(a.$el)}});rs.settings=new rs.models.SettingsModel({id:1}),rs.settings.fetch(),navigator.globalization&&navigator.globalization.getPreferredLanguage(function(a){alert("language: "+a.value+"\n");a.value},function(){});var b={resGetPath:"assets/locales/__lng__/__ns__.json",fallbackLng:"en",lng:rs.settings.selectedLanguage()};i18n.init(b,function(b){rs.t=b;var c=["home","info","settings","disclaimer","game-choice","memory/memory","memory/_card","quiz/quiz","quiz/mode","quiz/choose-players","quiz/result-solo","quiz/result-multi","quiz/question","quiz/switch-player","_game-partial"],d=["countries","topics","languages","memory_images"];$.when(rs.templateLoader.load(c),rs.dataLoader.load(d)).done(function(){var b=new a,c=new PageSlider($("#app"));b.slider=c,rs.router=b,rs.slider=c,Backbone.history.start();var d="ελληνικά";d=d.toLowerCase();_.find(rs.dataLoader.get("languages"),function(a){return a.locale_id===d||a.string_id===d||a.native_name===d})})})}};