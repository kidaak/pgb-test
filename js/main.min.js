var RoadSafetyApp=function(){this.initialize=function(){this.models={};this.views={};this.templateLoader=new this.TemplateLoader;this.dataLoader=new this.DataLoader};this.TemplateLoader=function(){this.templates={};this.load=function(e){var t=[],n=this;$.each(e,function(e,r){t.push($.get("tpl/"+r+".html",function(e){n.templates[r]=Handlebars.compile(e)}))});return $.when.apply(null,t)};this.get=function(e){return this.templates[e]}};this.DataLoader=function(){this.data={};this.load=function(e){var t=[],n=this;$.each(e,function(e,r){t.push($.get("assets/data/"+r+".json",function(e){n.data[r]=e}))});return $.when.apply(null,t)};this.get=function(e){return this.data[e]}};this.initialize()};rs=new RoadSafetyApp;rs.views.BasicView=Backbone.View.extend({events:{"click .pause":"showPauseScreen"},showPageMenu:function(){setTimeout(function(){app.enableTransitions();$(".page.left, .page.right").remove();$(".page-icon").removeClass("animate-1");setTimeout(function(){$(".page-text, .page-controls").removeClass("animate-1");setTimeout(function(){$(".page-play-txt").removeClass("animate-1")},100)},100)},300)},showPauseScreen:function(){$("#pause-screen, .scrollable").fadeIn();$(".bottom-menu").removeClass("animate-1")}});rs.views.SimpleView=Backbone.View.extend({initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render()},render:function(){this.$el.html(this.template());this.$el.i18n();return this}});rs.views.DisclaimerView=Backbone.View.extend({events:{},initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render()},render:function(){this.$el.html(this.template());this.$el.i18n();return this}});rs.views.InfosView=Backbone.View.extend({events:{"click .inner-menu li":"setActiveLI","click .show-menu, .selected-info":"showSingleMenu","click .inner-content":"hideAllMenus","click .left-menu li":"selectCountry","click .right-menu li":"selectTopic"},initialize:function(e){this.model=new rs.models.InfosModel;this.listenTo(this.model,"change:selectedCountry",this.updateContentPage);this.listenTo(this.model,"change:selectedTopic",this.updateContentPage);this.template=rs.templateLoader.get("infos");this.render()},render:function(){var e={countries:rs.dataLoader.get("countries"),topics:rs.dataLoader.get("topics")};this.$el.html(this.template(e));this.$el.i18n();return this},hideAllMenus:function(){this.$(".menu").addClass("hidden")},hideSingleMenu:function(e){var t=$(e.currentTarget);t.parents(".menu").addClass("hidden")},showSingleMenu:function(e){var t=$(e.currentTarget);e.stopPropagation();_.defer(function(){t.hasClass("show-left-menu")&&this.$(".left-menu").removeClass("hidden");t.hasClass("show-right-menu")&&this.$(".right-menu").removeClass("hidden")})},setActiveLI:function(e){var t=$(e.currentTarget);t.parents(".menu").find("li").removeClass("active");t.addClass("active")},selectCountry:function(e){var t=$(e.currentTarget);this.model.set("selectedCountry",t.attr("data-country"))},selectTopic:function(e){var t=$(e.currentTarget);this.model.set("selectedTopic",t.attr("data-topic"))},updateContentPage:function(){if(!this.model.selectionDone())return;this.hideAllMenus();var e=this,t="en";this.model.loadContentPage(t).done(function(t){var n=e.model.get("selectedCountry");e.$(".selected-country").text(rs.t("country."+n));var r=_.findWhere(rs.dataLoader.get("topics"),{topic_id:e.model.get("selectedTopic")}).string_id;e.$(".selected-topic").text(rs.t("topic."+r));e.$(".content-page").html(t)})}});rs.views.GameChoiceView=Backbone.View.extend({events:{},initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render()},render:function(){this.$el.html(this.template());this.$el.i18n();return this}});rs.views.MemoryView=rs.views.BasicView.extend({clickedCards:0,events:function(){return _.extend({},rs.views.BasicView.prototype.events,{"click #play":"showCards","click #cards li:not(.won)":"clickCards","click .page-controls .levels li":"switchCardsNumber"})},initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render();var t=this;_.defer(function(){t.appendCardsToDOM();t.showPageMenu()})},render:function(){this.$el.html(this.template());this.$el.i18n();return this},clickCards:function(e){var t=$(e.currentTarget),n=this;t.toggleClass("flipped");t.hasClass("flipped")&&n.clickedCards++;if(n.clickedCards===2){setTimeout(function(){$(".flipped").addClass("already-turned").find(".win-overlay").fadeIn(500,function(){$(".flipped").removeClass("flipped");n.wonGame();setTimeout(function(){$(".win-overlay").hide()},200)})},800);n.clickedCards=0}},showCards:function(e){e.preventDefault();var t=this,n=0,r=70;$("#progress").removeClass("animate-1");$(".cards-icon, .text, .page-controls, #play span","#memory").addClass("animate-1");setTimeout(function(){$(".scrollable").hide()},200);setTimeout(function(){t.$("#cards").show().find("li").each(function(){n+=r;var e=$(this);setTimeout(function(){e.removeClass("animate-1");t.$("#cards").find("li.animate-1").length===0&&t.showCounter()},n)})},600)},showCounter:function(){var e=200,t=1e3-e,n=$("#info"),r,i,s="Start",o=this;r=setInterval(function(){n.removeClass("animate-1");i=setTimeout(function(){clearTimeout(i);n.addClass("animate-1");setTimeout(function(){var e=n.text();n.text(e-1);e==1&&n.text(s);if(e==s){clearInterval(r);$("#game-overlay").hide()}},e*2)},t)},t)},wonGame:function(){var e="You win!",t=$("#info"),n=this;$("#game-overlay").show();setTimeout(function(){t.css("font-size","70px").text(e).removeClass("animate-1");setTimeout(function(){t.addClass("animate-1");setTimeout(function(){$("#cards li").addClass("animate-1");setTimeout(function(){$("#progress").addClass("animate-1");$("#final-scores").show();setTimeout(function(){$("#final-scores").find(".animate-1").removeClass("animate-1");$(".bottom-menu").removeClass("animate-1");app.animateNumbers($(".your-final-score"),1539)},1e3)})},300)},2e3)},200)},appendCardsToDOM:function(e){var t=rs.templateLoader.get("memory/_card"),n={filename:"car-1.png"},r=this.$("#cards"),s=r.data("cards-number");e&&(s=e);var o=r.find("ul"),u,a,f,l=r.outerHeight()-parseInt(r.css("top")),c=this;switch(s){case 24:u=4;break;case 12:u=3;break;case 6:u=2}a=s/u;f=l/a;o.empty();for(i=0;i<s;i++)o.append($(t(n)).height(f))},switchCardsNumber:function(e){var t=$(e.currentTarget),n=t.data("level");$("#cards").attr("data-cards-number",n);this.appendCardsToDOM(n)}});rs.views.SettingsView=Backbone.View.extend({events:{},initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render()},render:function(){this.$el.html(this.template());this.$el.i18n();return this}});rs.views.QuizzView=rs.views.BasicView.extend({events:{},initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render();var t=this;_.defer(function(){t.showPageMenu()})},render:function(){this.$el.html(this.template());this.$el.i18n();return this}});rs.views.ModeView=rs.views.BasicView.extend({events:{},initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render();var t=this},render:function(){this.$el.html(this.template());this.$el.i18n();return this}});rs.views.ChoosePlayersView=Backbone.View.extend({events:{"click .bottom li":"addPlayer"},initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render()},render:function(){this.$el.html(this.template());this.$el.i18n();return this},addPlayer:function(e){var t=$(e.currentTarget);t.find(".playing-container").toggleClass("hidden")}});rs.views.ResultMultiView=Backbone.View.extend({events:{},initialize:function(e){this.template=rs.templateLoader.get(e.templateName);this.render()},render:function(){this.$el.html(this.template());this.$el.i18n();return this}});rs.models.InfosModel=Backbone.Model.extend({defaults:{selectedCountry:null,selectedTopic:null},selectionDone:function(){return this.get("selectedCountry")!==null&&this.get("selectedTopic")!==null},loadContentPage:function(e){var t=this.get("selectedCountry"),n=this.get("selectedTopic"),r=this.getContentPagePath(t,n,e);return $.get(r)},getContentPagePath:function(e,t,n){return"assets/rules/"+n+"/"+e+"/"+e+"_"+t+"_"+n+".html"}});var app={initialize:function(){window.PhoneGap?this.bindEvents():this.onDeviceReady()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},enableTransitions:function(){$("body").removeClass("no-transition")},animateNumbers:function(e,t,n,r,i){var s=e,o=parseInt(s.text().replace(/,/g,""));n=n===undefined?!0:n;$({value:o}).animate({value:t},{duration:r==undefined?1e3:r,easing:i==undefined?"swing":i,step:function(){s.text(Math.floor(this.value));n&&s.text(s.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "))},complete:function(){if(parseInt(s.text())!==t){s.text(t);n&&s.text(s.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "))}}})},onDeviceReady:function(){console.log("device ready");FastClick.attach(document.body);var e=this;$(document).on("click",".try-again-btn",function(){Backbone.history.stop();Backbone.history.start()});$(document).on("touchstart",".page-controls .levels li",function(){var e=$(this);$(".page-controls .levels li").removeClass("active");e.addClass("active")});var t=Backbone.Router.extend({routes:{"":"home",settings:"settings",infos:"infos",disclaimer:"disclaimer","game-choice":"gameChoice",memory:"memory",quizz:"quizz",mode:"mode","choose-players":"choosePlayers","result-solo":"resultSolo","result-multi":"resultMulti"},initialize:function(){this.bind("all",this.change)},change:function(e){$("body").addClass("no-transition")},home:function(){var e=new rs.views.SimpleView({templateName:"home"});this.slider.slidePage(e.$el)},settings:function(){var e=new rs.views.SimpleView({templateName:"settings"});this.slider.slidePage(e.$el)},infos:function(){var e=new rs.views.InfosView({templateName:"infos"});this.slider.slidePage(e.$el)},disclaimer:function(){var e=new rs.views.InfosView({templateName:"disclaimer"});this.slider.slidePage(e.$el)},gameChoice:function(){var e=new rs.views.GameChoiceView({templateName:"game-choice"});this.slider.slidePage(e.$el)},memory:function(){var e=new rs.views.MemoryView({templateName:"memory/memory"});this.slider.slidePage(e.$el)},quizz:function(){var e=new rs.views.QuizzView({templateName:"quizz/quizz"});this.slider.slidePage(e.$el)},mode:function(){var e=new rs.views.ModeView({templateName:"quizz/mode"});this.slider.slidePage(e.$el)},choosePlayers:function(){var e=new rs.views.ChoosePlayersView({templateName:"quizz/choose-players"});this.slider.slidePage(e.$el)},resultSolo:function(){var e=new rs.views.ResultMultiView({templateName:"quizz/result-solo"});this.slider.slidePage(e.$el)},resultMulti:function(){var e=new rs.views.ResultMultiView({templateName:"quizz/result-multi"});this.slider.slidePage(e.$el)}}),n={resGetPath:"assets/locales/__lng__/__ns__.json",fallbackLng:"en",lng:"en"};i18n.init(n,function(e){rs.t=e;var n=["home","infos","settings","disclaimer","game-choice","memory/memory","memory/_card","quizz/quizz","quizz/mode","quizz/choose-players","quizz/result-solo","quizz/result-multi"],r=["countries","topics","languages"];$.when(rs.templateLoader.load(n),rs.dataLoader.load(r)).done(function(){console.log(rs.dataLoader.data);var e=new t;e.slider=new PageSlider($("#app"));Backbone.history.start()})})}};