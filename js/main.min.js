var RoadSafetyApp=function(){this.initialize=function(){this.models={},this.views={},this.templateLoader=new this.TemplateLoader},this.TemplateLoader=function(){this.templates={},this.load=function(a,b){var c=[],d=this;$.each(a,function(a,b){c.push($.get("tpl/"+b+".html",function(a){d.templates[b]=Handlebars.compile(a)}))}),$.when.apply(null,c).done(b)},this.get=function(a){return this.templates[a]}},this.initialize()};rs=new RoadSafetyApp,rs.views.BasicView=Backbone.View.extend({events:{"click .pause":"showPauseScreen"},showPageMenu:function(){setTimeout(function(){app.enableTransitions(),$(".page.left, .page.right").remove(),$(".page-icon").removeClass("animate-1"),setTimeout(function(){$(".page-text, .page-controls").removeClass("animate-1"),setTimeout(function(){$(".page-play-txt").removeClass("animate-1")},100)},100)},300)},showPauseScreen:function(){$("#pause-screen, .scrollable").fadeIn(),$(".bottom-menu").removeClass("animate-1")}}),rs.views.MemoryView=rs.views.BasicView.extend({clickedCards:0,events:function(){return _.extend({},rs.views.BasicView.prototype.events,{"click #play":"showCards","click #cards li:not(.won)":"clickCards","click .page-controls .levels li":"switchCardsNumber"})},initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render();var b=this;_.defer(function(){b.appendCardsToDOM(),b.showPageMenu()})},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this},clickCards:function(a){var b=$(a.currentTarget),c=this;b.toggleClass("flipped"),b.hasClass("flipped")&&c.clickedCards++,2===c.clickedCards&&(setTimeout(function(){$(".flipped").addClass("already-turned").find(".win-overlay").fadeIn(500,function(){$(".flipped").removeClass("flipped"),c.wonGame(),setTimeout(function(){$(".win-overlay").hide()},200)})},800),c.clickedCards=0)},showCards:function(a){a.preventDefault();var b=this,c=0,d=70;$("#progress").removeClass("animate-1"),$(".cards-icon, .text, .page-controls, #play span","#memory").addClass("animate-1"),setTimeout(function(){$(".scrollable").hide()},200),setTimeout(function(){b.$("#cards").show().find("li").each(function(){c+=d;var a=$(this);setTimeout(function(){a.removeClass("animate-1"),0===b.$("#cards").find("li.animate-1").length&&b.showCounter()},c)})},600)},showCounter:function(){var a,b,c=200,d=1e3-c,e=$("#info"),f="Start";a=setInterval(function(){e.removeClass("animate-1"),b=setTimeout(function(){clearTimeout(b),e.addClass("animate-1"),setTimeout(function(){var b=e.text();e.text(b-1),1==b&&e.text(f),b==f&&(clearInterval(a),$("#game-overlay").hide())},2*c)},d)},d)},wonGame:function(){var a="You win!",b=$("#info");$("#game-overlay").show(),setTimeout(function(){b.css("font-size","70px").text(a).removeClass("animate-1"),setTimeout(function(){b.addClass("animate-1"),setTimeout(function(){$("#cards li").addClass("animate-1"),setTimeout(function(){$("#progress").addClass("animate-1"),$("#final-scores").show(),setTimeout(function(){$("#final-scores").find(".animate-1").removeClass("animate-1"),$(".bottom-menu").removeClass("animate-1"),app.animateNumbers($(".your-final-score"),1539)},1e3)})},300)},2e3)},200)},appendCardsToDOM:function(a){var b=rs.templateLoader.get("memory/_card"),c={filename:"car-1.png"},d=this.$("#cards"),e=d.data("cards-number");a&&(e=a);var f,g,h,j=d.find("ul"),k=d.outerHeight()-parseInt(d.css("top"));switch(e){case 24:f=4;break;case 12:f=3;break;case 6:f=2}for(g=e/f,h=k/g,j.empty(),i=0;e>i;i++)j.append($(b(c)).height(h))},switchCardsNumber:function(a){var b=$(a.currentTarget),c=b.data("level");$("#cards").attr("data-cards-number",c),this.appendCardsToDOM(c)}}),rs.views.SimpleView=Backbone.View.extend({initialize:function(a){this.template=rs.templateLoader.get(a.templateName),this.render()},render:function(){return this.$el.html(this.template()),this.$el.i18n(),this}});var app={initialize:function(){window.PhoneGap?this.bindEvents():this.onDeviceReady()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},enableTransitions:function(){$("body").removeClass("no-transition")},animateNumbers:function(a,b,c,d,e){var f=a,g=parseInt(f.text().replace(/,/g,""));c=void 0===c?!0:c,$({value:g}).animate({value:b},{duration:void 0==d?1e3:d,easing:void 0==e?"swing":e,step:function(){f.text(Math.floor(this.value)),c&&f.text(f.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "))},complete:function(){parseInt(f.text())!==b&&(f.text(b),c&&f.text(f.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 ")))}})},onDeviceReady:function(){function a(){$(".menu").removeClass("hidden-menu"),$("#app").addClass("has-menu")}function b(){$(".menu").addClass("hidden-menu"),$("#app").removeClass("has-menu")}console.log("device ready"),FastClick.attach(document.body);$(document).on("click",".try-again-btn",function(){Backbone.history.stop(),Backbone.history.start()}),$(document).on("click",".page-controls .levels li",function(){var a=$(this);$(".page-controls .levels li").removeClass("active"),a.addClass("active")}),detectSwipe("#app",{swipeLeft:function(){$(".right-menu").removeClass("hidden")},swipeRight:function(){$(".left-menu").removeClass("hidden")}}),detectSwipe(".left-menu",{swipeLeft:function(){$(".left-menu").addClass("hidden")}}),detectSwipe(".right-menu",{swipeRight:function(){$(".right-menu").addClass("hidden")}}),$(".show-menu").click(function(){$(this).parents(".menu").toggleClass("hidden")});var c=Backbone.Router.extend({routes:{"":"home",infos:"infos",play:"play",memory:"memory"},initialize:function(){this.bind("all",this.change)},change:function(){$("body").addClass("no-transition")},home:function(){var a=new rs.views.SimpleView({templateName:"home"});this.slider.slidePage(a.$el),b()},infos:function(){var b=new rs.views.SimpleView({templateName:"infos"});this.slider.slidePage(b.$el),a()},memory:function(){var a=new rs.views.MemoryView({templateName:"memory/memory"});this.slider.slidePage(a.$el),b()}}),d={resGetPath:"assets/locales/__lng__/__ns__.json",fallbackLng:"en",lng:"en"};i18n.init(d,function(){rs.templateLoader.load(["home","infos","memory/memory","memory/_card"],function(){var a=new c;a.slider=new PageSlider($("#app")),Backbone.history.start()})})}};